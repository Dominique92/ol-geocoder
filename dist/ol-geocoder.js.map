{"version":3,"file":"ol-geocoder.js","sources":["../konstants/index.js","../src/helpers/mix.js","../src/helpers/dom.js","../src/html.js","../src/helpers/ajax.js","../src/providers/photon.js","../src/providers/osm.js","../src/providers/mapquest.js","../src/providers/bing.js","../src/providers/opencage.js","../src/nominatim.js","../src/base.js"],"sourcesContent":["import * as _VARS_ from './vars.json';\r\n\r\nexport const VARS = _VARS_;\r\n\r\nexport const EVENT_TYPE = {\r\n  ADDRESSCHOSEN: 'addresschosen',\r\n};\r\n\r\nexport const CONTROL_TYPE = {\r\n  NOMINATIM: 'nominatim',\r\n  REVERSE: 'reverse',\r\n};\r\n\r\nexport const TARGET_TYPE = {\r\n  GLASS: 'glass-button',\r\n  INPUT: 'text-input',\r\n};\r\n\r\nexport const FEATURE_SRC = '//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png';\r\n\r\nexport const PROVIDERS = {\r\n  OSM: 'osm',\r\n  MAPQUEST: 'mapquest',\r\n  PHOTON: 'photon',\r\n  BING: 'bing',\r\n  OPENCAGE: 'opencage',\r\n};\r\n\r\nexport const DEFAULT_OPTIONS = {\r\n  provider: PROVIDERS.OSM,\r\n  label: '',\r\n  placeholder: 'Search for an address',\r\n  featureStyle: null,\r\n  targetType: TARGET_TYPE.GLASS,\r\n  lang: 'en-US',\r\n  limit: 5,\r\n  keepOpen: false,\r\n  preventDefault: false,\r\n  preventPanning: false,\r\n  preventMarker: false,\r\n  defaultFlyResolution: 10, // Meters per pixel\r\n  debug: false,\r\n};","export function assert(condition, message = 'Assertion failed') {\r\n  if (!condition) {\r\n    if (typeof Error !== 'undefined') throw new Error(message);\r\n\r\n    throw message; // Fallback\r\n  }\r\n}\r\n\r\nexport function now() {\r\n  // Polyfill for window.performance.now()\r\n  // @license http://opensource.org/licenses/MIT\r\n  // copyright Paul Irish 2015\r\n  // https://gist.github.com/paulirish/5438650\r\n  if ('performance' in window === false) {\r\n    window.performance = {};\r\n  }\r\n\r\n  if ('now' in window.performance === false) {\r\n    let nowOffset = Date.now();\r\n\r\n    if (performance.timing && performance.timing.navigationStart) {\r\n      nowOffset = performance.timing.navigationStart;\r\n    }\r\n\r\n    window.performance.now = () => Date.now() - nowOffset;\r\n  }\r\n\r\n  return window.performance.now();\r\n}\r\n\r\nexport function randomId(prefix) {\r\n  const id = now().toString(36);\r\n\r\n  return prefix ? prefix + id : id;\r\n}\r\n\r\nexport function isNumeric(str) {\r\n  return /^\\d+$/u.test(str);\r\n}\r\n\r\nexport function isEmpty(str) {\r\n  return !str || str.length === 0;\r\n}\r\n\r\nexport function emptyArray(array) {\r\n  while (array.length) array.pop();\r\n}\r\n\r\nexport function anyMatchInArray(source, target) {\r\n  return source.some((each) => target.includes(each));\r\n}\r\n\r\nexport function everyMatchInArray(arr1, arr2) {\r\n  return arr2.every((each) => arr1.includes(each));\r\n}\r\n\r\nexport function anyItemHasValue(obj, has = false) {\r\n  const keys = Object.keys(obj);\r\n\r\n  keys.forEach((key) => {\r\n    if (!isEmpty(obj[key])) has = true;\r\n  });\r\n\r\n  return has;\r\n}","/* eslint-disable prefer-named-capture-group */\r\nimport {\r\n  isNumeric\r\n} from './mix';\r\n\r\n/**\r\n * @param {Element|Array<Element>} element DOM node or array of nodes.\r\n * @param {String|Array<String>} classname Class or array of classes.\r\n * For example: 'class1 class2' or ['class1', 'class2']\r\n * @param {Number|undefined} timeout Timeout to remove a class.\r\n */\r\nexport function addClass(element, classname, timeout) {\r\n  if (Array.isArray(element)) {\r\n    element.forEach((each) => addClass(each, classname));\r\n\r\n    return;\r\n  }\r\n\r\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\r\n\r\n  let i = array.length;\r\n\r\n  while (i--) {\r\n    if (!hasClass(element, array[i])) {\r\n      _addClass(element, array[i], timeout);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Element|Array<Element>} element DOM node or array of nodes.\r\n * @param {String|Array<String>} classname Class or array of classes.\r\n * For example: 'class1 class2' or ['class1', 'class2']\r\n * @param {Number|undefined} timeout Timeout to add a class.\r\n */\r\nexport function removeClass(element, classname, timeout) {\r\n  if (Array.isArray(element)) {\r\n    element.forEach((each) => removeClass(each, classname, timeout));\r\n\r\n    return;\r\n  }\r\n\r\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\r\n\r\n  let i = array.length;\r\n\r\n  while (i--) {\r\n    if (hasClass(element, array[i])) {\r\n      _removeClass(element, array[i], timeout);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Element} element DOM node.\r\n * @param {String} classname Classname.\r\n * @return {Boolean}\r\n */\r\nexport function hasClass(element, c) {\r\n  // use native if available\r\n  return element.classList ? element.classList.contains(c) : classRegex(c).test(element.className);\r\n}\r\n\r\n/**\r\n * @param {Element|Array<Element>} element DOM node or array of nodes.\r\n * @param {String} classname Classe.\r\n */\r\nexport function toggleClass(element, classname) {\r\n  if (Array.isArray(element)) {\r\n    element.forEach((each) => toggleClass(each, classname));\r\n\r\n    return;\r\n  }\r\n\r\n  // use native if available\r\n  if (element.classList) {\r\n    element.classList.toggle(classname);\r\n  } else {\r\n    hasClass(element, classname) ? _removeClass(element, classname) : _addClass(element, classname);\r\n  }\r\n}\r\n\r\n/**\r\n * Abstraction to querySelectorAll for increased\r\n * performance and greater usability\r\n * @param {String} selector\r\n * @param {Element} context (optional)\r\n * @param {Boolean} findAll (optional)\r\n * @return (findAll) {Element} : {Array}\r\n */\r\nexport function $(id) {\r\n  id = id[0] === '#' ? id.slice(1, 1 + id.length) : id;\r\n\r\n  return document.getElementById(id);\r\n}\r\n\r\nexport function isElement(obj) {\r\n  // DOM, Level2\r\n  if ('HTMLElement' in window) {\r\n    return !!obj && obj instanceof HTMLElement;\r\n  }\r\n\r\n  // Older browsers\r\n  return !!obj && typeof obj === 'object' && obj.nodeType === 1 && !!obj.nodeName;\r\n}\r\n\r\nexport function getAllChildren(node, tag) {\r\n  return [].slice.call(node.getElementsByTagName(tag));\r\n}\r\n\r\nexport function removeAllChildren(node) {\r\n  while (node.firstChild) node.firstChild.remove();\r\n}\r\n\r\nexport function removeAll(collection) {\r\n  let node;\r\n\r\n  while ((node = collection[0])) node.remove();\r\n}\r\n\r\nexport function getChildren(node, tag) {\r\n  return [].filter.call(node.childNodes, (el) =>\r\n    tag ? el.nodeType === 1 && el.tagName.toLowerCase() === tag : el.nodeType === 1\r\n  );\r\n}\r\n\r\nexport function template(html, row) {\r\n  return html.replace(/\\{\\s*([\\w-]+)\\s*\\}/gu, (htm, key) => {\r\n    const value = row[key] === undefined ? '' : row[key];\r\n\r\n    return htmlEscape(value);\r\n  });\r\n}\r\n\r\nexport function htmlEscape(str) {\r\n  return String(str)\r\n    .replaceAll('&', '&amp;')\r\n    .replaceAll('<', '&lt;')\r\n    .replaceAll('>', '&gt;')\r\n    .replaceAll('\"', '&quot;')\r\n    .replaceAll(\"'\", '&#039;');\r\n}\r\n\r\nexport function createElement(node, html) {\r\n  let elem;\r\n\r\n  if (Array.isArray(node)) {\r\n    elem = document.createElement(node[0]);\r\n\r\n    if (node[1].id) elem.id = node[1].id;\r\n\r\n    if (node[1].classname) elem.className = node[1].classname;\r\n\r\n    if (node[1].attr) {\r\n      const {\r\n        attr\r\n      } = node[1];\r\n\r\n      if (Array.isArray(attr)) {\r\n        let i = -1;\r\n\r\n        while (++i < attr.length) {\r\n          elem.setAttribute(attr[i].name, attr[i].value);\r\n        }\r\n      } else {\r\n        elem.setAttribute(attr.name, attr.value);\r\n      }\r\n    }\r\n  } else {\r\n    elem = document.createElement(node);\r\n  }\r\n\r\n  elem.innerHTML = html;\r\n\r\n  const frag = document.createDocumentFragment();\r\n\r\n  while (elem.childNodes[0]) frag.append(elem.childNodes[0]);\r\n\r\n  elem.append(frag);\r\n\r\n  return elem;\r\n}\r\n\r\nfunction classRegex(classname) {\r\n  return new RegExp(`(^|\\\\s+) ${classname} (\\\\s+|$)`, 'u');\r\n}\r\n\r\nfunction _addClass(el, klass, timeout) {\r\n  // use native if available\r\n  if (el.classList) {\r\n    el.classList.add(klass);\r\n  } else {\r\n    el.className = `${el.className} ${klass}`.trim();\r\n  }\r\n\r\n  if (timeout && isNumeric(timeout)) {\r\n    window.setTimeout(() => _removeClass(el, klass), timeout);\r\n  }\r\n}\r\n\r\nfunction _removeClass(el, klass, timeout) {\r\n  if (el.classList) {\r\n    el.classList.remove(klass);\r\n  } else {\r\n    el.className = el.className.replace(classRegex(klass), ' ').trim();\r\n  }\r\n\r\n  if (timeout && isNumeric(timeout)) {\r\n    window.setTimeout(() => _addClass(el, klass), timeout);\r\n  }\r\n}","import {\r\n  VARS,\r\n  TARGET_TYPE\r\n} from '../konstants';\r\n\r\nimport {\r\n  createElement\r\n} from './helpers/dom';\r\n\r\nconst klasses = VARS.cssClasses;\r\n\r\n/**\r\n * @class Html\r\n */\r\nexport default class Html {\r\n  /**\r\n   * @constructor\r\n   * @param {object} options Options.\r\n   */\r\n  constructor(options) {\r\n    this.options = options;\r\n    this.els = this.createControl();\r\n  }\r\n\r\n  createControl() {\r\n    let container;\r\n    let containerClass;\r\n    let elements;\r\n\r\n    if (this.options.targetType === TARGET_TYPE.INPUT) {\r\n      containerClass = `${klasses.namespace} ${klasses.inputText.container}`;\r\n      container = createElement(\r\n        ['div', {\r\n          id: VARS.containerId,\r\n          classname: containerClass\r\n        }],\r\n        Html.input\r\n      );\r\n      elements = {\r\n        container,\r\n        control: container.querySelector(`.${klasses.inputText.control}`),\r\n        label: container.querySelector(`.${klasses.inputText.label}`),\r\n        input: container.querySelector(`.${klasses.inputText.input}`),\r\n        search: container.querySelector(`.${klasses.inputText.search}`),\r\n        result: container.querySelector(`.${klasses.inputText.result}`),\r\n      };\r\n      elements.label.innerHTML = this.options.label;\r\n    } else {\r\n      containerClass = `${klasses.namespace} ${klasses.glass.container}`;\r\n      container = createElement(\r\n        ['div', {\r\n          id: VARS.containerId,\r\n          classname: containerClass\r\n        }],\r\n        Html.glass\r\n      );\r\n      elements = {\r\n        container,\r\n        control: container.querySelector(`.${klasses.glass.control}`),\r\n        button: container.querySelector(`.${klasses.glass.button}`),\r\n        input: container.querySelector(`.${klasses.glass.input}`),\r\n        search: container.querySelector(`.${klasses.glass.search}`),\r\n        result: container.querySelector(`.${klasses.glass.result}`),\r\n      };\r\n    }\r\n\r\n    // set placeholder from options\r\n    elements.input.placeholder = this.options.placeholder;\r\n\r\n    return elements;\r\n  }\r\n}\r\n\r\nHtml.glass = `\r\n  <div class=\"${klasses.glass.control} ${klasses.olControl}\">\r\n    <button type=\"button\" id=\"${VARS.buttonControlId}\" class=\"${klasses.glass.button}\"></button>\r\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.glass.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\r\n    <a id=\"${VARS.inputSearchId}\" class=\"${klasses.glass.search} ${klasses.hidden}\"></a>\r\n  </div>\r\n  <ul class=\"${klasses.glass.result}\"></ul>\r\n`;\r\n\r\nHtml.input = `\r\n  <div class=\"${klasses.inputText.control}\">\r\n    <label type=\"button\" id=\"${VARS.inputSearchId}\" class=\"${klasses.inputText.label}\"></label>\r\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.inputText.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\r\n    <span class=\"${klasses.inputText.icon}\"></span>\r\n    <button type=\"button\" id=\"${VARS.inputSearchId}\" class=\"${klasses.inputText.search} ${klasses.hidden}\"></button>\r\n  </div>\r\n  <ul class=\"${klasses.inputText.result}\"></ul>\r\n`;","export function json(obj) {\r\n  return new Promise((resolve, reject) => {\r\n    const url = encodeUrlXhr(obj.url, obj.data);\r\n    const config = {\r\n      method: 'GET',\r\n      mode: 'cors',\r\n      credentials: 'same-origin',\r\n    };\r\n\r\n    if (obj.jsonp) {\r\n      jsonp(url, obj.callbackName, resolve);\r\n    } else {\r\n      fetch(url, config)\r\n        .then((r) => r.json())\r\n        .then(resolve)\r\n        .catch(reject);\r\n    }\r\n  });\r\n}\r\n\r\nfunction toQueryString(obj) {\r\n  return Object.keys(obj)\r\n    .reduce((acc, k) => {\r\n      acc.push(\r\n        typeof obj[k] === 'object' ?\r\n        toQueryString(obj[k]) :\r\n        `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`\r\n      );\r\n\r\n      return acc;\r\n    }, [])\r\n    .join('&');\r\n}\r\n\r\nfunction encodeUrlXhr(url, data) {\r\n  if (data && typeof data === 'object') {\r\n    url += (/\\?/u.test(url) ? '&' : '?') + toQueryString(data);\r\n  }\r\n\r\n  return url;\r\n}\r\n\r\nfunction jsonp(url, key, callback) {\r\n  // https://github.com/Fresheyeball/micro-jsonp/blob/master/src/jsonp.js\r\n  const {\r\n    head\r\n  } = document;\r\n  const script = document.createElement('script');\r\n  // generate minimally unique name for callback function\r\n  const callbackName = `f${Math.round(Math.random() * Date.now())}`;\r\n\r\n  // set request url\r\n  script.setAttribute(\r\n    'src',\r\n    // add callback parameter to the url\r\n    //    where key is the parameter key supplied\r\n    //    and callbackName is the parameter value\r\n    `${url + (url.indexOf('?') > 0 ? '&' : '?') + key}=${callbackName}`\r\n  );\r\n\r\n  // place jsonp callback on window,\r\n  //  the script sent by the server should call this\r\n  //  function as it was passed as a url parameter\r\n  window[callbackName] = (data) => {\r\n    window[callbackName] = undefined;\r\n\r\n    // clean up script tag created for request\r\n    setTimeout(() => head.removeChild(script), 0);\r\n\r\n    // hand data back to the user\r\n    callback(data);\r\n  };\r\n\r\n  // actually make the request\r\n  head.append(script);\r\n}","/**\r\n * @class Photon\r\n */\r\nexport default class Photon {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    this.settings = {\r\n      url: 'https://photon.komoot.io/api/',\r\n\r\n      params: {\r\n        q: '',\r\n        limit: 10,\r\n        lang: 'en',\r\n      },\r\n\r\n      langs: ['de', 'it', 'fr', 'en'],\r\n    };\r\n  }\r\n\r\n  getParameters(options) {\r\n    options.lang = options.lang.toLowerCase();\r\n\r\n    return {\r\n      url: this.settings.url,\r\n\r\n      params: {\r\n        q: options.query,\r\n        limit: options.limit || this.settings.params.limit,\r\n\r\n        lang: this.settings.langs.includes(options.lang) ? options.lang : this.settings.params.lang,\r\n      },\r\n    };\r\n  }\r\n\r\n  handleResponse(results) {\r\n    if (results.features.length === 0) return [];\r\n\r\n    return results.features.map((result) => ({\r\n      lon: result.geometry.coordinates[0],\r\n      lat: result.geometry.coordinates[1],\r\n\r\n      address: {\r\n        name: result.properties.name,\r\n        postcode: result.properties.postcode,\r\n        city: result.properties.city,\r\n        state: result.properties.state,\r\n        country: result.properties.country,\r\n      },\r\n\r\n      original: {\r\n        formatted: result.properties.name,\r\n        details: result.properties,\r\n      },\r\n    }));\r\n  }\r\n}","/**\r\n * @class OpenStreet\r\n */\r\nexport default class OpenStreet {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor(options) {\r\n    this.settings = {\r\n      url: 'https://nominatim.openstreetmap.org/search',\r\n      ...options, // Allow custom URL for osm provider https://github.com/Dominique92/ol-geocoder/issues/266\r\n\r\n      params: {\r\n        q: '',\r\n        format: 'json',\r\n        addressdetails: 1,\r\n        limit: 10,\r\n        countrycodes: '',\r\n        viewbox: '',\r\n        'accept-language': 'en-US',\r\n      },\r\n    };\r\n  }\r\n\r\n  getParameters(opt) {\r\n    return {\r\n      url: this.settings.url,\r\n\r\n      params: {\r\n        q: opt.query,\r\n        format: this.settings.params.format,\r\n        addressdetails: this.settings.params.addressdetails,\r\n        limit: opt.limit || this.settings.params.limit,\r\n        countrycodes: opt.countrycodes || this.settings.params.countrycodes,\r\n        viewbox: opt.viewbox || this.settings.params.viewbox,\r\n        'accept-language': opt.lang || this.settings.params['accept-language'],\r\n      },\r\n    };\r\n  }\r\n\r\n  handleResponse(results) {\r\n    if (results.length === 0) return [];\r\n\r\n    return results.map((result) => ({\r\n      lon: result.lon,\r\n      lat: result.lat,\r\n      bbox: result.boundingbox,\r\n\r\n      address: {\r\n        name: result.display_name,\r\n        road: result.address.road || '',\r\n        houseNumber: result.address.house_number || '',\r\n        postcode: result.address.postcode,\r\n        city: result.address.city || result.address.town,\r\n        state: result.address.state,\r\n        country: result.address.country,\r\n      },\r\n\r\n      original: {\r\n        formatted: result.display_name,\r\n        details: result.address,\r\n      },\r\n    }));\r\n  }\r\n}","/**\r\n * @class MapQuest\r\n */\r\nexport default class MapQuest {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    this.settings = {\r\n      url: 'https://open.mapquestapi.com/nominatim/v1/search.php',\r\n\r\n      params: {\r\n        q: '',\r\n        key: '',\r\n        format: 'json',\r\n        addressdetails: 1,\r\n        limit: 10,\r\n        countrycodes: '',\r\n        'accept-language': 'en-US',\r\n      },\r\n    };\r\n  }\r\n\r\n  getParameters(options) {\r\n    return {\r\n      url: this.settings.url,\r\n\r\n      params: {\r\n        q: options.query,\r\n        key: options.key,\r\n        format: 'json',\r\n        addressdetails: 1,\r\n        limit: options.limit || this.settings.params.limit,\r\n        countrycodes: options.countrycodes || this.settings.params.countrycodes,\r\n\r\n        'accept-language': options.lang || this.settings.params['accept-language'],\r\n      },\r\n    };\r\n  }\r\n\r\n  handleResponse(results) {\r\n    if (results.length === 0) return [];\r\n\r\n    return results.map((result) => ({\r\n      lon: result.lon,\r\n      lat: result.lat,\r\n\r\n      address: {\r\n        name: result.address.neighbourhood || '',\r\n        road: result.address.road || '',\r\n        postcode: result.address.postcode,\r\n        city: result.address.city || result.address.town,\r\n        state: result.address.state,\r\n        country: result.address.country,\r\n      },\r\n\r\n      original: {\r\n        formatted: result.display_name,\r\n        details: result.address,\r\n      },\r\n    }));\r\n  }\r\n}","/**\r\n * @class Bing\r\n */\r\nexport default class Bing {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    this.settings = {\r\n      url: 'https://dev.virtualearth.net/REST/v1/Locations',\r\n      callbackName: 'jsonp',\r\n\r\n      params: {\r\n        query: '',\r\n        key: '',\r\n        includeNeighborhood: 0,\r\n        maxResults: 10,\r\n      },\r\n    };\r\n  }\r\n\r\n  getParameters(options) {\r\n    return {\r\n      url: this.settings.url,\r\n      callbackName: this.settings.callbackName,\r\n\r\n      params: {\r\n        query: options.query,\r\n        key: options.key,\r\n\r\n        includeNeighborhood: options.includeNeighborhood || this.settings.params.includeNeighborhood,\r\n\r\n        maxResults: options.maxResults || this.settings.params.maxResults,\r\n      },\r\n    };\r\n  }\r\n\r\n  handleResponse(results) {\r\n    const {\r\n      resources\r\n    } = results.resourceSets[0];\r\n\r\n    if (resources.length === 0) return [];\r\n\r\n    return resources.map((result) => ({\r\n      lon: result.point.coordinates[1],\r\n      lat: result.point.coordinates[0],\r\n\r\n      address: {\r\n        name: result.name,\r\n      },\r\n\r\n      original: {\r\n        formatted: result.address.formattedAddress,\r\n        details: result.address,\r\n      },\r\n    }));\r\n  }\r\n}","/**\r\n * @class OpenCage\r\n */\r\nexport default class OpenCage {\r\n  /**\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    this.settings = {\r\n      url: 'https://api.opencagedata.com/geocode/v1/json?',\r\n\r\n      params: {\r\n        q: '',\r\n        key: '',\r\n        limit: 10,\r\n        countrycode: '',\r\n        pretty: 1,\r\n        no_annotations: 1,\r\n      },\r\n    };\r\n  }\r\n\r\n  getParameters(options) {\r\n    return {\r\n      url: this.settings.url,\r\n\r\n      params: {\r\n        q: options.query,\r\n        key: options.key,\r\n        limit: options.limit || this.settings.params.limit,\r\n        countrycode: options.countrycodes || this.settings.params.countrycodes,\r\n      },\r\n    };\r\n  }\r\n\r\n  handleResponse(results) {\r\n    if (results.results.length === 0) return [];\r\n\r\n    return results.results.map((result) => ({\r\n      lon: result.geometry.lng,\r\n      lat: result.geometry.lat,\r\n\r\n      address: {\r\n        name: result.components.house_number || '',\r\n        road: result.components.road || '',\r\n        postcode: result.components.postcode,\r\n        city: result.components.city || result.components.town,\r\n        state: result.components.state,\r\n        country: result.components.country,\r\n      },\r\n\r\n      original: {\r\n        formatted: result.formatted,\r\n        details: result.components,\r\n      },\r\n    }));\r\n  }\r\n}","import LayerVector from 'ol/layer/Vector';\r\nimport SourceVector from 'ol/source/Vector';\r\nimport Point from 'ol/geom/Point';\r\nimport Feature from 'ol/Feature';\r\nimport * as proj from 'ol/proj';\r\n\r\nimport {\r\n  VARS,\r\n  TARGET_TYPE,\r\n  PROVIDERS,\r\n  EVENT_TYPE\r\n} from '../konstants';\r\nimport {\r\n  hasClass,\r\n  addClass,\r\n  removeClass,\r\n  createElement,\r\n  template,\r\n  removeAllChildren,\r\n} from './helpers/dom';\r\nimport {\r\n  randomId\r\n} from './helpers/mix';\r\nimport {\r\n  json\r\n} from './helpers/ajax';\r\n\r\nimport Photon from './providers/photon';\r\nimport OpenStreet from './providers/osm';\r\nimport MapQuest from './providers/mapquest';\r\nimport Bing from './providers/bing';\r\nimport OpenCage from './providers/opencage';\r\n\r\nconst klasses = VARS.cssClasses;\r\n\r\n/**\r\n * @class Nominatim\r\n */\r\nexport default class Nominatim {\r\n  /**\r\n   * @constructor\r\n   * @param {Function} base Base class.\r\n   */\r\n  constructor(base, els) {\r\n    this.Base = base;\r\n\r\n    this.layerName = randomId('geocoder-layer-');\r\n    this.layer = new LayerVector({\r\n      background: 'transparent',\r\n      name: this.layerName,\r\n      source: new SourceVector(),\r\n      displayInLayerSwitcher: false, // Remove search layer from legend https://github.com/Dominique92/ol-geocoder/issues/256\r\n    });\r\n\r\n    this.options = base.options;\r\n    // provider is either the name of a built-in provider as a string or an\r\n    // object that implements the provider API\r\n    this.options.provider =\r\n      typeof this.options.provider === 'string' ?\r\n      this.options.provider.toLowerCase() :\r\n      this.options.provider;\r\n    this.provider = this.newProvider();\r\n\r\n    this.els = els;\r\n    this.lastQuery = '';\r\n    this.container = this.els.container;\r\n    this.registeredListeners = {\r\n      mapClick: false,\r\n    };\r\n    this.setListeners();\r\n  }\r\n\r\n  setListeners() {\r\n    const openSearch = (evt) => {\r\n      evt.stopPropagation();\r\n      hasClass(this.els.control, klasses.glass.expanded) ? this.collapse() : this.expand();\r\n    };\r\n    const query = (evt) => {\r\n      const value = evt.target.value.trim();\r\n      const hit = evt.key ?\r\n        evt.key === 'Enter' :\r\n        evt.which ?\r\n        evt.which === 13 :\r\n        evt.keyCode ?\r\n        evt.keyCode === 13 :\r\n        false;\r\n\r\n      if (hit) {\r\n        evt.preventDefault();\r\n        this.query(value);\r\n      }\r\n    };\r\n    const stopBubbling = (evt) => evt.stopPropagation();\r\n    const search = () => {\r\n      this.els.input.focus();\r\n      this.query(this.els.input.value);\r\n    };\r\n    const handleValue = (evt) => {\r\n      const value = evt.target.value.trim();\r\n\r\n      value.length !== 0 ?\r\n        removeClass(this.els.search, klasses.hidden) :\r\n        addClass(this.els.search, klasses.hidden);\r\n    };\r\n\r\n    this.els.input.addEventListener('keypress', query, false);\r\n    this.els.input.addEventListener('click', stopBubbling, false);\r\n    this.els.input.addEventListener('input', handleValue, false);\r\n    this.els.search.addEventListener('click', search, false);\r\n\r\n    if (this.options.targetType === TARGET_TYPE.GLASS) {\r\n      this.els.button.addEventListener('click', openSearch, false);\r\n    }\r\n  }\r\n\r\n  query(q) {\r\n    // lazy provider\r\n    if (!this.provider) {\r\n      this.provider = this.newProvider();\r\n    }\r\n\r\n    const parameters = this.provider.getParameters({\r\n      query: q,\r\n      key: this.options.key,\r\n      lang: this.options.lang,\r\n      countrycodes: this.options.countrycodes,\r\n      viewbox: this.options.viewbox,\r\n      limit: this.options.limit,\r\n    });\r\n\r\n    if (this.lastQuery === q && this.els.result.firstChild) return;\r\n\r\n    this.lastQuery = q;\r\n    this.clearResults();\r\n    addClass(this.els.search, klasses.spin);\r\n\r\n    const ajax = {\r\n      url: parameters.url,\r\n      data: parameters.params,\r\n    };\r\n\r\n    if (parameters.callbackName) {\r\n      ajax.jsonp = true;\r\n      ajax.callbackName = parameters.callbackName;\r\n    }\r\n\r\n    json(ajax)\r\n      .then((res) => {\r\n        // eslint-disable-next-line no-console\r\n        this.options.debug && console.info(res);\r\n\r\n        removeClass(this.els.search, klasses.spin);\r\n\r\n        // will be fullfiled according to provider\r\n        const res_ = this.provider.handleResponse(res);\r\n\r\n        if (res_) {\r\n          this.createList(res_);\r\n          this.listenMapClick();\r\n        }\r\n      })\r\n      .catch(() => {\r\n        removeClass(this.els.search, klasses.spin);\r\n\r\n        const li = createElement('li', '<h5>Error! No internet connection?</h5>');\r\n\r\n        this.els.result.append(li);\r\n      });\r\n  }\r\n\r\n  createList(response) {\r\n    const ul = this.els.result;\r\n\r\n    response.forEach((row) => {\r\n      let addressHtml;\r\n\r\n      switch (this.options.provider) {\r\n        case PROVIDERS.OSM:\r\n          addressHtml = `<span class=\"${klasses.road}\">${row.address.name}</span>`;\r\n          break;\r\n\r\n        default:\r\n          addressHtml = this.addressTemplate(row.address);\r\n      }\r\n\r\n      if (response.length == 1) {\r\n        this.chosen(row, addressHtml, row.address, row.original);\r\n      } else {\r\n        const li = createElement('li', `<a href=\"#\">${addressHtml}</a>`);\r\n\r\n        li.addEventListener(\r\n          'click',\r\n          (evt) => {\r\n            evt.preventDefault();\r\n            this.chosen(row, addressHtml, row.address, row.original);\r\n          },\r\n          false\r\n        );\r\n\r\n        ul.append(li);\r\n      }\r\n    });\r\n  }\r\n\r\n  chosen(place, addressHtml, addressObj, addressOriginal) {\r\n    const map = this.Base.getMap();\r\n    const coord_ = [Number.parseFloat(place.lon), Number.parseFloat(place.lat)];\r\n    const projection = map.getView().getProjection();\r\n    const coord = proj.transform(coord_, 'EPSG:4326', projection);\r\n\r\n    let {\r\n      bbox\r\n    } = place;\r\n\r\n    if (bbox) {\r\n      bbox = proj.transformExtent(\r\n        // https://nominatim.org/release-docs/latest/api/Output/#boundingbox\r\n        // Requires parseFloat on negative bbox entries\r\n        [parseFloat(bbox[2]), parseFloat(bbox[0]), parseFloat(bbox[3]), parseFloat(bbox[1])], // SNWE -> WSEN\r\n        'EPSG:4326',\r\n        projection\r\n      );\r\n    }\r\n\r\n    const address = {\r\n      formatted: addressHtml,\r\n      details: addressObj,\r\n      original: addressOriginal,\r\n    };\r\n\r\n    this.options.keepOpen === false && this.clearResults(true);\r\n\r\n    if (this.options.preventDefault === true || this.options.preventMarker === true) {\r\n      // No display change\r\n      this.Base.dispatchEvent({\r\n        type: EVENT_TYPE.ADDRESSCHOSEN,\r\n        address,\r\n        coordinate: coord,\r\n        bbox,\r\n        place,\r\n      });\r\n    } else {\r\n      // Display a marker\r\n      const feature = this.createFeature(coord, address);\r\n\r\n      this.Base.dispatchEvent({\r\n        type: EVENT_TYPE.ADDRESSCHOSEN,\r\n        address,\r\n        feature,\r\n        coordinate: coord,\r\n        bbox,\r\n        place,\r\n      });\r\n    }\r\n\r\n    if (this.options.preventDefault !== true && this.options.preventPanning !== true) {\r\n      // Move & zoom to the position\r\n      if (bbox) {\r\n        map.getView().fit(bbox, {\r\n          duration: 500,\r\n        });\r\n      } else {\r\n        map.getView().animate({\r\n          center: coord,\r\n          // ol-geocoder results are too much zoomed -in Dominique92/ol-geocoder#235\r\n          resolution: this.options.defaultFlyResolution,\r\n          duration: 500,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  createFeature(coord) {\r\n    const feature = new Feature(new Point(coord));\r\n\r\n    this.addLayer();\r\n    feature.setStyle(this.options.featureStyle);\r\n    feature.setId(randomId('geocoder-ft-'));\r\n    this.getSource().addFeature(feature);\r\n\r\n    return feature;\r\n  }\r\n\r\n  addressTemplate(address) {\r\n    const html = [];\r\n\r\n    if (address.name) {\r\n      html.push(['<span class=\"', klasses.road, '\">{name}</span>'].join(''));\r\n    }\r\n\r\n    if (address.road || address.building || address.house_number) {\r\n      html.push(\r\n        ['<span class=\"', klasses.road, '\">{building} {road} {house_number}</span>'].join('')\r\n      );\r\n    }\r\n\r\n    if (address.city || address.town || address.village) {\r\n      html.push(\r\n        ['<span class=\"', klasses.city, '\">{postcode} {city} {town} {village}</span>'].join('')\r\n      );\r\n    }\r\n\r\n    if (address.state || address.country) {\r\n      html.push(['<span class=\"', klasses.country, '\">{state} {country}</span>'].join(''));\r\n    }\r\n\r\n    return template(html.join('<br>'), address);\r\n  }\r\n\r\n  newProvider() {\r\n    switch (this.options.provider) {\r\n      case PROVIDERS.OSM:\r\n        return new OpenStreet(this.options);\r\n      case PROVIDERS.MAPQUEST:\r\n        return new MapQuest();\r\n      case PROVIDERS.PHOTON:\r\n        return new Photon();\r\n      case PROVIDERS.BING:\r\n        return new Bing();\r\n      case PROVIDERS.OPENCAGE:\r\n        return new OpenCage();\r\n\r\n      default:\r\n        return this.options.provider;\r\n    }\r\n  }\r\n\r\n  expand() {\r\n    removeClass(this.els.input, klasses.spin);\r\n    addClass(this.els.control, klasses.glass.expanded);\r\n    window.setTimeout(() => this.els.input.focus(), 100);\r\n    this.listenMapClick();\r\n  }\r\n\r\n  collapse() {\r\n    this.els.input.value = '';\r\n    this.els.input.blur();\r\n    addClass(this.els.search, klasses.hidden);\r\n    removeClass(this.els.control, klasses.glass.expanded);\r\n    this.clearResults();\r\n  }\r\n\r\n  listenMapClick() {\r\n    // already registered\r\n    if (this.registeredListeners.mapClick) return;\r\n\r\n    const that = this;\r\n    const mapElement = this.Base.getMap().getTargetElement();\r\n\r\n    this.registeredListeners.mapClick = true;\r\n\r\n    // one-time fire click\r\n    mapElement.addEventListener(\r\n      'click', {\r\n        handleEvent(evt) {\r\n          that.clearResults(true);\r\n          mapElement.removeEventListener(evt.type, this, false);\r\n          that.registeredListeners.mapClick = false;\r\n        },\r\n      },\r\n      false\r\n    );\r\n  }\r\n\r\n  clearResults(collapse) {\r\n    collapse && this.options.targetType === TARGET_TYPE.GLASS ?\r\n      this.collapse() :\r\n      removeAllChildren(this.els.result);\r\n  }\r\n\r\n  getSource() {\r\n    return this.layer.getSource();\r\n  }\r\n\r\n  addLayer() {\r\n    let found = false;\r\n\r\n    const map = this.Base.getMap();\r\n\r\n    map.getLayers().forEach((layer) => {\r\n      if (layer === this.layer) found = true;\r\n    });\r\n\r\n    if (!found) map.addLayer(this.layer);\r\n  }\r\n}","import Control from 'ol/control/Control';\r\nimport Style from 'ol/style/Style';\r\nimport Icon from 'ol/style/Icon';\r\n\r\nimport {\r\n  CONTROL_TYPE,\r\n  DEFAULT_OPTIONS,\r\n  FEATURE_SRC\r\n} from '../konstants';\r\n\r\nimport Html from './html';\r\nimport Nominatim from './nominatim';\r\nimport {\r\n  assert,\r\n} from './helpers/mix';\r\n\r\n/**\r\n * @class Base\r\n * @extends {ol.control.Control}\r\n */\r\nexport default class Base extends Control {\r\n  /**\r\n   * @constructor\r\n   * @param {string} type nominatim|reverse.\r\n   * @param {object} options Options.\r\n   */\r\n  constructor(type = CONTROL_TYPE.NOMINATIM, opt) {\r\n    assert(typeof type === 'string', '@param `type` should be string!');\r\n    assert(\r\n      type === CONTROL_TYPE.NOMINATIM || type === CONTROL_TYPE.REVERSE,\r\n      `@param 'type' should be '${CONTROL_TYPE.NOMINATIM}'\r\n      or '${CONTROL_TYPE.REVERSE}'!`\r\n    );\r\n    const options = {\r\n      ...DEFAULT_OPTIONS,\r\n      featureStyle: [\r\n        new Style({\r\n          image: new Icon({\r\n            scale: 0.7,\r\n            src: FEATURE_SRC\r\n          })\r\n        }),\r\n      ],\r\n      ...opt,\r\n    };\r\n\r\n    let container;\r\n    let $nominatim;\r\n    const $html = new Html(options);\r\n\r\n    if (type === CONTROL_TYPE.NOMINATIM) {\r\n      container = $html.els.container;\r\n    }\r\n\r\n    super({\r\n      element: container,\r\n      ...options, // Allows to add ol.control.Control options (as target:)\r\n    });\r\n\r\n    if (!(this instanceof Base)) return new Base();\r\n\r\n    this.options = options;\r\n    this.container = container;\r\n\r\n    if (type === CONTROL_TYPE.NOMINATIM) {\r\n      $nominatim = new Nominatim(this, $html.els);\r\n      this.layer = $nominatim.layer;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {ol.layer.Vector} Returns the layer created by this control\r\n   */\r\n  getLayer() {\r\n    return this.layer;\r\n  }\r\n\r\n  /**\r\n   * @return {ol.source.Vector} Returns the source created by this control\r\n   */\r\n  getSource() {\r\n    return this.getLayer().getSource();\r\n  }\r\n\r\n  /**\r\n   * Set a new provider\r\n   * @param {String} provider\r\n   */\r\n  setProvider(provider) {\r\n    this.options.provider = provider;\r\n  }\r\n\r\n  /**\r\n   * Set provider key\r\n   * @param {String} key\r\n   */\r\n  setProviderKey(key) {\r\n    this.options.key = key;\r\n  }\r\n}"],"names":["VARS","EVENT_TYPE","CONTROL_TYPE","TARGET_TYPE","PROVIDERS","DEFAULT_OPTIONS","provider","label","placeholder","featureStyle","targetType","lang","limit","keepOpen","preventDefault","preventPanning","preventMarker","defaultFlyResolution","debug","assert","condition","message","Error","randomId","prefix","id","window","performance","nowOffset","Date","now","timing","navigationStart","toString","isNumeric","str","test","addClass","element","classname","timeout","Array","isArray","forEach","each","array","split","i","length","hasClass","_addClass","removeClass","_removeClass","c","classList","contains","classRegex","className","template","html","row","replace","htm","key","value","undefined","String","replaceAll","createElement","node","elem","document","attr","setAttribute","name","innerHTML","frag","createDocumentFragment","childNodes","append","RegExp","el","klass","add","trim","setTimeout","remove","klasses","cssClasses","Html","constructor","options","this","els","createControl","container","containerClass","elements","namespace","inputText","containerId","input","control","querySelector","search","result","glass","button","json","obj","Promise","resolve","reject","url","data","toQueryString","encodeUrlXhr","config","method","mode","credentials","jsonp","callback","head","script","callbackName","Math","round","random","indexOf","removeChild","fetch","then","r","catch","Object","keys","reduce","acc","k","push","encodeURIComponent","join","olControl","buttonControlId","inputQueryId","inputSearchId","hidden","icon","Photon","settings","params","q","langs","getParameters","toLowerCase","query","includes","handleResponse","results","features","map","lon","geometry","coordinates","lat","address","properties","postcode","city","state","country","original","formatted","details","OpenStreet","format","addressdetails","countrycodes","viewbox","opt","bbox","boundingbox","display_name","road","houseNumber","house_number","town","MapQuest","neighbourhood","Bing","includeNeighborhood","maxResults","resources","resourceSets","point","formattedAddress","OpenCage","countrycode","pretty","no_annotations","lng","components","Nominatim","base","Base","layerName","layer","LayerVector","background","source","SourceVector","displayInLayerSwitcher","newProvider","lastQuery","registeredListeners","mapClick","setListeners","openSearch","evt","stopPropagation","expanded","collapse","expand","addEventListener","target","which","keyCode","focus","parameters","firstChild","clearResults","spin","ajax","res","console","info","res_","createList","listenMapClick","li","response","ul","addressHtml","addressTemplate","chosen","place","addressObj","addressOriginal","getMap","coord_","Number","parseFloat","projection","getView","getProjection","coord","proj","transform","transformExtent","dispatchEvent","type","coordinate","feature","createFeature","fit","duration","animate","center","resolution","Feature","Point","addLayer","setStyle","setId","getSource","addFeature","building","village","blur","that","mapElement","getTargetElement","handleEvent","removeEventListener","removeAllChildren","found","getLayers","Control","Style","image","Icon","scale","src","$nominatim","$html","super","getLayer","setProvider","setProviderKey"],"mappings":"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"}