{"version":3,"file":"ol-geocoder.js","sources":["../konstants/index.js","../src/helpers/mix.js","../src/helpers/dom.js","../src/html.js","../src/providers/photon.js","../src/providers/osm.js","../src/providers/mapquest.js","../src/providers/bing.js","../src/providers/opencage.js","../src/helpers/ajax.js","../src/nominatim.js","../src/base.js"],"sourcesContent":["import * as _VARS_ from './vars.json';\n\nexport const VARS = _VARS_;\n\nexport const EVENT_TYPE = {\n  ADDRESSCHOSEN: 'addresschosen',\n};\n\nexport const CONTROL_TYPE = {\n  NOMINATIM: 'nominatim',\n  REVERSE: 'reverse',\n};\n\nexport const TARGET_TYPE = {\n  GLASS: 'glass-button',\n  INPUT: 'text-input',\n};\n\nexport const FEATURE_SRC = '//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png';\n\nexport const PROVIDERS = {\n  OSM: 'osm',\n  MAPQUEST: 'mapquest',\n  PHOTON: 'photon',\n  BING: 'bing',\n  OPENCAGE: 'opencage',\n};\n\nexport const DEFAULT_OPTIONS = {\n  provider: PROVIDERS.OSM,\n  placeholder: 'Search for an address',\n  featureStyle: null,\n  targetType: TARGET_TYPE.GLASS,\n  lang: 'en-US',\n  limit: 5,\n  keepOpen: false,\n  preventDefault: false,\n  autoComplete: false,\n  autoCompleteMinLength: 2,\n  autoCompleteTimeout: 200,\n  debug: false,\n};\n","/**\n * Overwrites obj1's values with obj2's and adds\n * obj2's if non existent in obj1\n * @returns obj3 a new object based on obj1 and obj2\n */\nexport function mergeOptions(obj1, obj2) {\n  const obj3 = {};\n\n  Object.keys(obj1).forEach((key) => {\n    if (Object.prototype.hasOwnProperty.call(obj1, key)) {\n      obj3[key] = obj1[key];\n    }\n  });\n\n  Object.keys(obj2).forEach((key) => {\n    if (Object.prototype.hasOwnProperty.call(obj2, key)) {\n      obj3[key] = obj2[key];\n    }\n  });\n\n  return obj3;\n}\n\nexport function assert(condition, message = 'Assertion failed') {\n  if (!condition) {\n    if (typeof Error !== 'undefined') throw new Error(message);\n\n    throw message; // Fallback\n  }\n}\n\nexport function now() {\n  // Polyfill for window.performance.now()\n  // @license http://opensource.org/licenses/MIT\n  // copyright Paul Irish 2015\n  // https://gist.github.com/paulirish/5438650\n  if ('performance' in window === false) {\n    window.performance = {};\n  }\n\n  if ('now' in window.performance === false) {\n    let nowOffset = Date.now();\n\n    if (performance.timing && performance.timing.navigationStart) {\n      nowOffset = performance.timing.navigationStart;\n    }\n\n    window.performance.now = () => Date.now() - nowOffset;\n  }\n\n  return window.performance.now();\n}\n\nexport function flyTo(map, coord, duration = 500, resolution = 2.388657133911758) {\n  map.getView().animate({ duration, resolution }, { duration, center: coord });\n}\n\nexport function randomId(prefix) {\n  const id = now().toString(36);\n\n  return prefix ? prefix + id : id;\n}\n\nexport function isNumeric(str) {\n  return /^\\d+$/u.test(str);\n}\n\nexport function isEmpty(str) {\n  return !str || str.length === 0;\n}\n\nexport function emptyArray(array) {\n  while (array.length) array.pop();\n}\n\nexport function anyMatchInArray(source, target) {\n  return source.some((each) => target.includes(each));\n}\n\nexport function everyMatchInArray(arr1, arr2) {\n  return arr2.every((each) => arr1.includes(each));\n}\n\nexport function anyItemHasValue(obj, has = false) {\n  const keys = Object.keys(obj);\n\n  keys.forEach((key) => {\n    if (!isEmpty(obj[key])) has = true;\n  });\n\n  return has;\n}\n","/* eslint-disable prefer-named-capture-group */\nimport { isNumeric } from './mix';\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String|Array<String>} classname Class or array of classes.\n * For example: 'class1 class2' or ['class1', 'class2']\n * @param {Number|undefined} timeout Timeout to remove a class.\n */\nexport function addClass(element, classname, timeout) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => addClass(each, classname));\n\n    return;\n  }\n\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\n\n  let i = array.length;\n\n  while (i--) {\n    if (!hasClass(element, array[i])) {\n      _addClass(element, array[i], timeout);\n    }\n  }\n}\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String|Array<String>} classname Class or array of classes.\n * For example: 'class1 class2' or ['class1', 'class2']\n * @param {Number|undefined} timeout Timeout to add a class.\n */\nexport function removeClass(element, classname, timeout) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => removeClass(each, classname, timeout));\n\n    return;\n  }\n\n  const array = Array.isArray(classname) ? classname : classname.split(/\\s+/u);\n\n  let i = array.length;\n\n  while (i--) {\n    if (hasClass(element, array[i])) {\n      _removeClass(element, array[i], timeout);\n    }\n  }\n}\n\n/**\n * @param {Element} element DOM node.\n * @param {String} classname Classname.\n * @return {Boolean}\n */\nexport function hasClass(element, c) {\n  // use native if available\n  return element.classList ? element.classList.contains(c) : classRegex(c).test(element.className);\n}\n\n/**\n * @param {Element|Array<Element>} element DOM node or array of nodes.\n * @param {String} classname Classe.\n */\nexport function toggleClass(element, classname) {\n  if (Array.isArray(element)) {\n    element.forEach((each) => toggleClass(each, classname));\n\n    return;\n  }\n\n  // use native if available\n  if (element.classList) {\n    element.classList.toggle(classname);\n  } else {\n    hasClass(element, classname) ? _removeClass(element, classname) : _addClass(element, classname);\n  }\n}\n\n/**\n * Abstraction to querySelectorAll for increased\n * performance and greater usability\n * @param {String} selector\n * @param {Element} context (optional)\n * @param {Boolean} findAll (optional)\n * @return (findAll) {Element} : {Array}\n */\nexport function $(id) {\n  id = id[0] === '#' ? id.slice(1, 1 + id.length) : id;\n\n  return document.getElementById(id);\n}\n\nexport function isElement(obj) {\n  // DOM, Level2\n  if ('HTMLElement' in window) {\n    return !!obj && obj instanceof HTMLElement;\n  }\n\n  // Older browsers\n  return !!obj && typeof obj === 'object' && obj.nodeType === 1 && !!obj.nodeName;\n}\n\nexport function getAllChildren(node, tag) {\n  return [].slice.call(node.getElementsByTagName(tag));\n}\n\nexport function removeAllChildren(node) {\n  while (node.firstChild) node.firstChild.remove();\n}\n\nexport function removeAll(collection) {\n  let node;\n\n  while ((node = collection[0])) node.remove();\n}\n\nexport function getChildren(node, tag) {\n  return [].filter.call(node.childNodes, (el) =>\n    tag ? el.nodeType === 1 && el.tagName.toLowerCase() === tag : el.nodeType === 1\n  );\n}\n\nexport function template(html, row) {\n  return html.replace(/\\{\\s*([\\w-]+)\\s*\\}/gu, (htm, key) => {\n    const value = row[key] === undefined ? '' : row[key];\n\n    return htmlEscape(value);\n  });\n}\n\nexport function htmlEscape(str) {\n  return String(str)\n    .replaceAll('&', '&amp;')\n    .replaceAll('<', '&lt;')\n    .replaceAll('>', '&gt;')\n    .replaceAll('\"', '&quot;')\n    .replaceAll(\"'\", '&#039;');\n}\n\nexport function createElement(node, html) {\n  let elem;\n\n  if (Array.isArray(node)) {\n    elem = document.createElement(node[0]);\n\n    if (node[1].id) elem.id = node[1].id;\n\n    if (node[1].classname) elem.className = node[1].classname;\n\n    if (node[1].attr) {\n      const { attr } = node[1];\n\n      if (Array.isArray(attr)) {\n        let i = -1;\n\n        while (++i < attr.length) {\n          elem.setAttribute(attr[i].name, attr[i].value);\n        }\n      } else {\n        elem.setAttribute(attr.name, attr.value);\n      }\n    }\n  } else {\n    elem = document.createElement(node);\n  }\n\n  elem.innerHTML = html;\n\n  const frag = document.createDocumentFragment();\n\n  while (elem.childNodes[0]) frag.append(elem.childNodes[0]);\n\n  elem.append(frag);\n\n  return elem;\n}\n\nfunction classRegex(classname) {\n  return new RegExp(`(^|\\\\s+) ${classname} (\\\\s+|$)`, 'u');\n}\n\nfunction _addClass(el, klass, timeout) {\n  // use native if available\n  if (el.classList) {\n    el.classList.add(klass);\n  } else {\n    el.className = `${el.className} ${klass}`.trim();\n  }\n\n  if (timeout && isNumeric(timeout)) {\n    window.setTimeout(() => _removeClass(el, klass), timeout);\n  }\n}\n\nfunction _removeClass(el, klass, timeout) {\n  if (el.classList) {\n    el.classList.remove(klass);\n  } else {\n    el.className = el.className.replace(classRegex(klass), ' ').trim();\n  }\n\n  if (timeout && isNumeric(timeout)) {\n    window.setTimeout(() => _addClass(el, klass), timeout);\n  }\n}\n","import { VARS, TARGET_TYPE } from '../konstants';\n\nimport { createElement } from './helpers/dom';\n\nconst klasses = VARS.cssClasses;\n\n/**\n * @class Html\n */\nexport class Html {\n  /**\n   * @constructor\n   * @param {object} options Options.\n   */\n  constructor(options) {\n    this.options = options;\n    this.els = this.createControl();\n  }\n\n  createControl() {\n    let container;\n    let containerClass;\n    let elements;\n\n    if (this.options.targetType === TARGET_TYPE.INPUT) {\n      containerClass = `${klasses.namespace} ${klasses.inputText.container}`;\n      container = createElement(\n        ['div', { id: VARS.containerId, classname: containerClass }],\n        Html.input\n      );\n      elements = {\n        container,\n        control: container.querySelector(`.${klasses.inputText.control}`),\n        input: container.querySelector(`.${klasses.inputText.input}`),\n        reset: container.querySelector(`.${klasses.inputText.reset}`),\n        result: container.querySelector(`.${klasses.inputText.result}`),\n      };\n    } else {\n      containerClass = `${klasses.namespace} ${klasses.glass.container}`;\n      container = createElement(\n        ['div', { id: VARS.containerId, classname: containerClass }],\n        Html.glass\n      );\n      elements = {\n        container,\n        control: container.querySelector(`.${klasses.glass.control}`),\n        button: container.querySelector(`.${klasses.glass.button}`),\n        input: container.querySelector(`.${klasses.glass.input}`),\n        reset: container.querySelector(`.${klasses.glass.reset}`),\n        result: container.querySelector(`.${klasses.glass.result}`),\n      };\n    }\n\n    // set placeholder from options\n    elements.input.placeholder = this.options.placeholder;\n\n    return elements;\n  }\n}\n\nHtml.glass = `\n  <div class=\"${klasses.glass.control} ${klasses.olControl}\">\n    <button type=\"button\" id=\"${VARS.buttonControlId}\" class=\"${klasses.glass.button}\"></button>\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.glass.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\n    <a id=\"${VARS.inputResetId}\" class=\"${klasses.glass.reset} ${klasses.hidden}\"></a>\n  </div>\n  <ul class=\"${klasses.glass.result}\"></ul>\n`;\n\nHtml.input = `\n  <div class=\"${klasses.inputText.control}\">\n    <input type=\"text\" id=\"${VARS.inputQueryId}\" class=\"${klasses.inputText.input}\" autocomplete=\"off\" placeholder=\"Search ...\">\n    <span class=\"${klasses.inputText.icon}\"></span>\n    <button type=\"button\" id=\"${VARS.inputResetId}\" class=\"${klasses.inputText.reset} ${klasses.hidden}\"></button>\n  </div>\n  <ul class=\"${klasses.inputText.result}\"></ul>\n`;\n","/**\n * @class Photon\n */\nexport class Photon {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: 'https://photon.komoot.io/api/',\n\n      params: {\n        q: '',\n        limit: 10,\n        lang: 'en',\n      },\n\n      langs: ['de', 'it', 'fr', 'en'],\n    };\n  }\n\n  getParameters(options) {\n    options.lang = options.lang.toLowerCase();\n\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        limit: options.limit || this.settings.params.limit,\n\n        lang: this.settings.langs.includes(options.lang) ? options.lang : this.settings.params.lang,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.features.length === 0) return [];\n\n    return results.features.map((result) => ({\n      lon: result.geometry.coordinates[0],\n      lat: result.geometry.coordinates[1],\n\n      address: {\n        name: result.properties.name,\n        postcode: result.properties.postcode,\n        city: result.properties.city,\n        state: result.properties.state,\n        country: result.properties.country,\n      },\n\n      original: {\n        formatted: result.properties.name,\n        details: result.properties,\n      },\n    }));\n  }\n}\n","/**\n * @class OpenStreet\n */\nexport class OpenStreet {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: 'https://nominatim.openstreetmap.org/search',\n\n      params: {\n        q: '',\n        format: 'json',\n        addressdetails: 1,\n        limit: 10,\n        countrycodes: '',\n        'accept-language': 'en-US',\n      },\n    };\n  }\n\n  getParameters(opt) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: opt.query,\n        format: this.settings.params.format,\n        addressdetails: this.settings.params.addressdetails,\n        limit: opt.limit || this.settings.params.limit,\n        countrycodes: opt.countrycodes || this.settings.params.countrycodes,\n        'accept-language': opt.lang || this.settings.params['accept-language'],\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.length === 0) return [];\n\n    return results.map((result) => ({\n      lon: result.lon,\n      lat: result.lat,\n      bbox: result.boundingbox,\n\n      address: {\n        name: result.display_name,\n        road: result.address.road || '',\n        houseNumber: result.address.house_number || '',\n        postcode: result.address.postcode,\n        city: result.address.city || result.address.town,\n        state: result.address.state,\n        country: result.address.country,\n      },\n\n      original: {\n        formatted: result.display_name,\n        details: result.address,\n      },\n    }));\n  }\n}\n","/**\n * @class MapQuest\n */\nexport class MapQuest {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: 'https://open.mapquestapi.com/nominatim/v1/search.php',\n\n      params: {\n        q: '',\n        key: '',\n        format: 'json',\n        addressdetails: 1,\n        limit: 10,\n        countrycodes: '',\n        'accept-language': 'en-US',\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        key: options.key,\n        format: 'json',\n        addressdetails: 1,\n        limit: options.limit || this.settings.params.limit,\n        countrycodes: options.countrycodes || this.settings.params.countrycodes,\n\n        'accept-language': options.lang || this.settings.params['accept-language'],\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.length === 0) return [];\n\n    return results.map((result) => ({\n      lon: result.lon,\n      lat: result.lat,\n\n      address: {\n        name: result.address.neighbourhood || '',\n        road: result.address.road || '',\n        postcode: result.address.postcode,\n        city: result.address.city || result.address.town,\n        state: result.address.state,\n        country: result.address.country,\n      },\n\n      original: {\n        formatted: result.display_name,\n        details: result.address,\n      },\n    }));\n  }\n}\n","/**\n * @class Bing\n */\nexport class Bing {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: 'https://dev.virtualearth.net/REST/v1/Locations',\n      callbackName: 'jsonp',\n\n      params: {\n        query: '',\n        key: '',\n        includeNeighborhood: 0,\n        maxResults: 10,\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n      callbackName: this.settings.callbackName,\n\n      params: {\n        query: options.query,\n        key: options.key,\n\n        includeNeighborhood:\n          options.includeNeighborhood || this.settings.params.includeNeighborhood,\n\n        maxResults: options.maxResults || this.settings.params.maxResults,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    const { resources } = results.resourceSets[0];\n\n    if (resources.length === 0) return [];\n\n    return resources.map((result) => ({\n      lon: result.point.coordinates[1],\n      lat: result.point.coordinates[0],\n\n      address: {\n        name: result.name,\n      },\n\n      original: {\n        formatted: result.address.formattedAddress,\n        details: result.address,\n      },\n    }));\n  }\n}\n","/**\n * @class OpenCage\n */\nexport class OpenCage {\n  /**\n   * @constructor\n   */\n  constructor() {\n    this.settings = {\n      url: 'https://api.opencagedata.com/geocode/v1/json?',\n\n      params: {\n        q: '',\n        key: '',\n        limit: 10,\n        countrycode: '',\n        pretty: 1,\n        no_annotations: 1,\n      },\n    };\n  }\n\n  getParameters(options) {\n    return {\n      url: this.settings.url,\n\n      params: {\n        q: options.query,\n        key: options.key,\n        limit: options.limit || this.settings.params.limit,\n        countrycode: options.countrycodes || this.settings.params.countrycodes,\n      },\n    };\n  }\n\n  handleResponse(results) {\n    if (results.results.length === 0) return [];\n\n    return results.results.map((result) => ({\n      lon: result.geometry.lng,\n      lat: result.geometry.lat,\n\n      address: {\n        name: result.components.house_number || '',\n        road: result.components.road || '',\n        postcode: result.components.postcode,\n        city: result.components.city || result.components.town,\n        state: result.components.state,\n        country: result.components.country,\n      },\n\n      original: {\n        formatted: result.formatted,\n        details: result.components,\n      },\n    }));\n  }\n}\n","export function json(obj) {\n  return new Promise((resolve, reject) => {\n    const url = encodeUrlXhr(obj.url, obj.data);\n    const config = {\n      method: 'GET',\n      mode: 'cors',\n      credentials: 'same-origin',\n    };\n\n    if (obj.jsonp) {\n      jsonp(url, obj.callbackName, resolve);\n    } else {\n      fetch(url, config)\n        .then((r) => r.json())\n        .then(resolve)\n        .catch(reject);\n    }\n  });\n}\n\nfunction toQueryString(obj) {\n  return Object.keys(obj)\n    .reduce((acc, k) => {\n      acc.push(\n        typeof obj[k] === 'object'\n          ? toQueryString(obj[k])\n          : `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`\n      );\n\n      return acc;\n    }, [])\n    .join('&');\n}\n\nfunction encodeUrlXhr(url, data) {\n  if (data && typeof data === 'object') {\n    url += (/\\?/u.test(url) ? '&' : '?') + toQueryString(data);\n  }\n\n  return url;\n}\n\nfunction jsonp(url, key, callback) {\n  // https://github.com/Fresheyeball/micro-jsonp/blob/master/src/jsonp.js\n  const { head } = document;\n  const script = document.createElement('script');\n  // generate minimally unique name for callback function\n  const callbackName = `f${Math.round(Math.random() * Date.now())}`;\n\n  // set request url\n  script.setAttribute(\n    'src',\n    // add callback parameter to the url\n    //    where key is the parameter key supplied\n    //    and callbackName is the parameter value\n    `${url + (url.indexOf('?') > 0 ? '&' : '?') + key}=${callbackName}`\n  );\n\n  // place jsonp callback on window,\n  //  the script sent by the server should call this\n  //  function as it was passed as a url parameter\n  window[callbackName] = (data) => {\n    window[callbackName] = undefined;\n\n    // clean up script tag created for request\n    setTimeout(() => head.removeChild(script), 0);\n\n    // hand data back to the user\n    callback(data);\n  };\n\n  // actually make the request\n  head.append(script);\n}\n","import LayerVector from 'ol/layer/Vector';\nimport SourceVector from 'ol/source/Vector';\nimport Point from 'ol/geom/Point';\nimport Feature from 'ol/Feature';\nimport proj from 'ol/proj';\n\nimport { VARS, TARGET_TYPE, PROVIDERS, EVENT_TYPE } from '../konstants';\n\nimport {\n  hasClass,\n  addClass,\n  removeClass,\n  createElement,\n  template,\n  removeAllChildren,\n} from './helpers/dom';\nimport { Photon } from './providers/photon';\nimport { OpenStreet } from './providers/osm';\nimport { MapQuest } from './providers/mapquest';\nimport { Bing } from './providers/bing';\nimport { OpenCage } from './providers/opencage';\nimport { randomId, flyTo } from './helpers/mix';\nimport { json } from './helpers/ajax';\n\nconst klasses = VARS.cssClasses;\n\n/**\n * @class Nominatim\n */\nexport class Nominatim {\n  /**\n   * @constructor\n   * @param {Function} base Base class.\n   */\n  constructor(base, els) {\n    this.Base = base;\n\n    this.layerName = randomId('geocoder-layer-');\n    this.layer = new LayerVector({\n      name: this.layerName,\n      source: new SourceVector(),\n    });\n\n    this.options = base.options;\n    // provider is either the name of a built-in provider as a string or an\n    // object that implements the provider API\n    this.options.provider =\n      typeof this.options.provider === 'string'\n        ? this.options.provider.toLowerCase()\n        : this.options.provider;\n    this.provider = this.newProvider();\n\n    this.els = els;\n    this.lastQuery = '';\n    this.container = this.els.container;\n    this.registeredListeners = { mapClick: false };\n    this.setListeners();\n  }\n\n  setListeners() {\n    let timeout;\n    let lastQuery;\n\n    const openSearch = (evt) => {\n      evt.stopPropagation();\n\n      hasClass(this.els.control, klasses.glass.expanded) ? this.collapse() : this.expand();\n    };\n    const query = (evt) => {\n      const value = evt.target.value.trim();\n      const hit = evt.key\n        ? evt.key === 'Enter'\n        : evt.which\n        ? evt.which === 13\n        : evt.keyCode\n        ? evt.keyCode === 13\n        : false;\n\n      if (hit) {\n        evt.preventDefault();\n        this.query(value);\n      }\n    };\n    const stopBubbling = (evt) => evt.stopPropagation();\n    const reset = (evt) => {\n      this.els.input.focus();\n      this.els.input.value = '';\n      this.lastQuery = '';\n      addClass(this.els.reset, klasses.hidden);\n      this.clearResults();\n    };\n    const handleValue = (evt) => {\n      const value = evt.target.value.trim();\n\n      value.length !== 0\n        ? removeClass(this.els.reset, klasses.hidden)\n        : addClass(this.els.reset, klasses.hidden);\n\n      if (this.options.autoComplete && value !== lastQuery) {\n        lastQuery = value;\n        timeout && clearTimeout(timeout);\n        timeout = setTimeout(() => {\n          if (value.length >= this.options.autoCompleteMinLength) {\n            this.query(value);\n          }\n        }, this.options.autoCompleteTimeout);\n      }\n    };\n\n    this.els.input.addEventListener('keypress', query, false);\n    this.els.input.addEventListener('click', stopBubbling, false);\n    this.els.input.addEventListener('input', handleValue, false);\n    this.els.reset.addEventListener('click', reset, false);\n\n    if (this.options.targetType === TARGET_TYPE.GLASS) {\n      this.els.button.addEventListener('click', openSearch, false);\n    }\n  }\n\n  query(q) {\n    // lazy provider\n    if (!this.provider) {\n      this.provider = this.newProvider();\n    }\n\n    const parameters = this.provider.getParameters({\n      query: q,\n      key: this.options.key,\n      lang: this.options.lang,\n      countrycodes: this.options.countrycodes,\n      limit: this.options.limit,\n    });\n\n    if (this.lastQuery === q && this.els.result.firstChild) return;\n\n    this.lastQuery = q;\n    this.clearResults();\n    addClass(this.els.reset, klasses.spin);\n\n    const ajax = {\n      url: parameters.url,\n      data: parameters.params,\n    };\n\n    if (parameters.callbackName) {\n      ajax.jsonp = true;\n      ajax.callbackName = parameters.callbackName;\n    }\n\n    json(ajax)\n      .then((res) => {\n        // eslint-disable-next-line no-console\n        this.options.debug && console.info(res);\n\n        removeClass(this.els.reset, klasses.spin);\n\n        // will be fullfiled according to provider\n        const res_ = this.provider.handleResponse(res);\n\n        if (res_) {\n          this.createList(res_);\n          this.listenMapClick();\n        }\n      })\n      .catch((err) => {\n        removeClass(this.els.reset, klasses.spin);\n\n        const li = createElement('li', '<h5>Error! No internet connection?</h5>');\n\n        this.els.result.append(li);\n      });\n  }\n\n  createList(response) {\n    const ul = this.els.result;\n\n    response.forEach((row) => {\n      let addressHtml;\n\n      switch (this.options.provider) {\n        case PROVIDERS.OSM:\n          addressHtml = `<span class=\"${klasses.road}\">${row.address.name}</span>`;\n\n          break;\n\n        default:\n          addressHtml = this.addressTemplate(row.address);\n      }\n\n      const html = `<a href=\"#\">${addressHtml}</a>`;\n      const li = createElement('li', html);\n\n      li.addEventListener(\n        'click',\n        (evt) => {\n          evt.preventDefault();\n          this.chosen(row, addressHtml, row.address, row.original);\n        },\n        false\n      );\n\n      ul.append(li);\n    });\n  }\n\n  chosen(place, addressHtml, addressObj, addressOriginal) {\n    const map = this.Base.getMap();\n    const coord_ = [Number.parseFloat(place.lon), Number.parseFloat(place.lat)];\n    const projection = map.getView().getProjection();\n    const coord = proj.transform(coord_, 'EPSG:4326', projection);\n\n    let { bbox } = place;\n\n    if (bbox) {\n      bbox = proj.transformExtent(\n        [bbox[2], bbox[1], bbox[3], bbox[0]], // NSWE -> WSEN\n        'EPSG:4326',\n        projection\n      );\n    }\n\n    const address = {\n      formatted: addressHtml,\n      details: addressObj,\n      original: addressOriginal,\n    };\n\n    this.options.keepOpen === false && this.clearResults(true);\n\n    if (this.options.preventDefault === true) {\n      this.Base.dispatchEvent({\n        type: EVENT_TYPE.ADDRESSCHOSEN,\n        address,\n        coordinate: coord,\n        bbox,\n        place,\n      });\n    } else {\n      if (bbox) {\n        map.getView().fit(bbox, { duration: 500 });\n      } else {\n        flyTo(map, coord);\n      }\n\n      const feature = this.createFeature(coord, address);\n\n      this.Base.dispatchEvent({\n        type: EVENT_TYPE.ADDRESSCHOSEN,\n        address,\n        feature,\n        coordinate: coord,\n        bbox,\n        place,\n      });\n    }\n  }\n\n  createFeature(coord) {\n    const feature = new Feature(new Point(coord));\n\n    this.addLayer();\n    feature.setStyle(this.options.featureStyle);\n    feature.setId(randomId('geocoder-ft-'));\n    this.getSource().addFeature(feature);\n\n    return feature;\n  }\n\n  addressTemplate(address) {\n    const html = [];\n\n    if (address.name) {\n      html.push(['<span class=\"', klasses.road, '\">{name}</span>'].join(''));\n    }\n\n    if (address.road || address.building || address.house_number) {\n      html.push(\n        ['<span class=\"', klasses.road, '\">{building} {road} {house_number}</span>'].join('')\n      );\n    }\n\n    if (address.city || address.town || address.village) {\n      html.push(\n        ['<span class=\"', klasses.city, '\">{postcode} {city} {town} {village}</span>'].join('')\n      );\n    }\n\n    if (address.state || address.country) {\n      html.push(['<span class=\"', klasses.country, '\">{state} {country}</span>'].join(''));\n    }\n\n    return template(html.join('<br>'), address);\n  }\n\n  newProvider() {\n    switch (this.options.provider) {\n      case PROVIDERS.OSM:\n        return new OpenStreet();\n      case PROVIDERS.MAPQUEST:\n        return new MapQuest();\n      case PROVIDERS.PHOTON:\n        return new Photon();\n      case PROVIDERS.BING:\n        return new Bing();\n      case PROVIDERS.OPENCAGE:\n        return new OpenCage();\n\n      default:\n        return this.options.provider;\n    }\n  }\n\n  expand() {\n    removeClass(this.els.input, klasses.spin);\n    addClass(this.els.control, klasses.glass.expanded);\n    window.setTimeout(() => this.els.input.focus(), 100);\n    this.listenMapClick();\n  }\n\n  collapse() {\n    this.els.input.value = '';\n    this.els.input.blur();\n    addClass(this.els.reset, klasses.hidden);\n    removeClass(this.els.control, klasses.glass.expanded);\n    this.clearResults();\n  }\n\n  listenMapClick() {\n    // already registered\n    if (this.registeredListeners.mapClick) return;\n\n    const that = this;\n    const mapElement = this.Base.getMap().getTargetElement();\n\n    this.registeredListeners.mapClick = true;\n\n    // one-time fire click\n    mapElement.addEventListener(\n      'click',\n      {\n        handleEvent(evt) {\n          that.clearResults(true);\n          mapElement.removeEventListener(evt.type, this, false);\n          that.registeredListeners.mapClick = false;\n        },\n      },\n      false\n    );\n  }\n\n  clearResults(collapse) {\n    collapse && this.options.targetType === TARGET_TYPE.GLASS\n      ? this.collapse()\n      : removeAllChildren(this.els.result);\n  }\n\n  getSource() {\n    return this.layer.getSource();\n  }\n\n  addLayer() {\n    let found = false;\n\n    const map = this.Base.getMap();\n\n    map.getLayers().forEach((layer) => {\n      if (layer === this.layer) found = true;\n    });\n\n    if (!found) map.addLayer(this.layer);\n  }\n}\n","import Control from 'ol/control/Control';\nimport Style from 'ol/style/Style';\nimport Icon from 'ol/style/Icon';\n\nimport { CONTROL_TYPE, DEFAULT_OPTIONS, FEATURE_SRC } from '../konstants';\n\nimport { Html } from './html';\nimport { Nominatim } from './nominatim';\nimport { assert, mergeOptions } from './helpers/mix';\n\n/**\n * @class Base\n * @extends {ol.control.Control}\n */\nexport default class Base extends Control {\n  /**\n   * @constructor\n   * @param {string} type nominatim|reverse.\n   * @param {object} options Options.\n   */\n  constructor(type = CONTROL_TYPE.NOMINATIM, options = {}) {\n    assert(typeof type === 'string', '@param `type` should be string!');\n    assert(\n      type === CONTROL_TYPE.NOMINATIM || type === CONTROL_TYPE.REVERSE,\n      `@param 'type' should be '${CONTROL_TYPE.NOMINATIM}'\n      or '${CONTROL_TYPE.REVERSE}'!`\n    );\n    assert(typeof options === 'object', '@param `options` should be object!');\n\n    DEFAULT_OPTIONS.featureStyle = [\n      new Style({ image: new Icon({ scale: 0.7, src: FEATURE_SRC }) }),\n    ];\n\n    let container;\n\n    let $nominatim;\n\n    const $html = new Html(options);\n\n    if (type === CONTROL_TYPE.NOMINATIM) {\n      container = $html.els.container;\n    }\n\n    super({ element: container });\n\n    if (!(this instanceof Base)) return new Base();\n\n    this.options = mergeOptions(DEFAULT_OPTIONS, options);\n    this.container = container;\n\n    if (type === CONTROL_TYPE.NOMINATIM) {\n      $nominatim = new Nominatim(this, $html.els);\n      this.layer = $nominatim.layer;\n    }\n  }\n\n  /**\n   * @return {ol.layer.Vector} Returns the layer created by this control\n   */\n  getLayer() {\n    return this.layer;\n  }\n\n  /**\n   * @return {ol.source.Vector} Returns the source created by this control\n   */\n  getSource() {\n    return this.getLayer().getSource();\n  }\n\n  /**\n   * Set a new provider\n   * @param {String} provider\n   */\n  setProvider(provider) {\n    this.options.provider = provider;\n  }\n\n  /**\n   * Set provider key\n   * @param {String} key\n   */\n  setProviderKey(key) {\n    this.options.key = key;\n  }\n}\n"],"names":["VARS","EVENT_TYPE","CONTROL_TYPE","TARGET_TYPE","PROVIDERS","DEFAULT_OPTIONS","provider","placeholder","featureStyle","targetType","lang","limit","keepOpen","preventDefault","autoComplete","autoCompleteMinLength","autoCompleteTimeout","debug","assert","condition","message","Error","randomId","prefix","id","window","performance","nowOffset","Date","now","timing","navigationStart","toString","isNumeric","str","test","addClass","element","classname","timeout","Array","isArray","forEach","each","array","split","i","length","hasClass","_addClass","removeClass","_removeClass","c","classList","contains","classRegex","className","template","html","row","replace","htm","key","value","undefined","String","replaceAll","createElement","node","elem","document","attr","setAttribute","name","innerHTML","frag","createDocumentFragment","childNodes","append","RegExp","el","klass","add","trim","setTimeout","remove","klasses","cssClasses","Html","constructor","options","this","els","createControl","container","containerClass","elements","namespace","inputText","containerId","input","control","querySelector","reset","result","glass","button","olControl","buttonControlId","inputQueryId","inputResetId","hidden","icon","Photon","settings","url","params","q","langs","getParameters","toLowerCase","query","includes","handleResponse","results","features","map","lon","geometry","coordinates","lat","address","properties","postcode","city","state","country","original","formatted","details","OpenStreet","format","addressdetails","countrycodes","opt","bbox","boundingbox","display_name","road","houseNumber","house_number","town","MapQuest","neighbourhood","Bing","callbackName","includeNeighborhood","maxResults","resources","resourceSets","point","formattedAddress","OpenCage","countrycode","pretty","no_annotations","lng","components","json","obj","Promise","resolve","reject","data","toQueryString","encodeUrlXhr","config","method","mode","credentials","jsonp","callback","head","script","Math","round","random","indexOf","removeChild","fetch","then","r","catch","Object","keys","reduce","acc","k","push","encodeURIComponent","join","Nominatim","base","Base","layerName","layer","LayerVector","source","SourceVector","newProvider","lastQuery","registeredListeners","mapClick","setListeners","openSearch","evt","stopPropagation","expanded","collapse","expand","addEventListener","target","which","keyCode","clearTimeout","focus","clearResults","parameters","firstChild","spin","ajax","res","console","info","res_","createList","listenMapClick","err","li","response","ul","addressHtml","addressTemplate","chosen","place","addressObj","addressOriginal","getMap","coord_","Number","parseFloat","projection","getView","getProjection","coord","proj","transform","transformExtent","dispatchEvent","type","coordinate","fit","duration","resolution","animate","center","flyTo","feature","createFeature","Feature","Point","addLayer","setStyle","setId","getSource","addFeature","building","village","blur","that","mapElement","getTargetElement","handleEvent","removeEventListener","removeAllChildren","found","getLayers","Control","$nominatim","Style","image","Icon","scale","src","$html","super","obj1","obj2","obj3","prototype","hasOwnProperty","call","mergeOptions","getLayer","setProvider","setProviderKey"],"mappings":";;;;;;i+CAEO,MAAMA,uHAEAC,EACI,gBAGJC,EACA,YADAA,EAEF,UAGEC,EACJ,eADIA,EAEJ,aAKIC,EACN,MADMA,EAED,WAFCA,EAGH,SAHGA,EAIL,OAJKA,EAKD,WAGCC,EAAkB,CAC7BC,SAAUF,EACVG,YAAa,wBACbC,aAAc,KACdC,WAAYN,EACZO,KAAM,QACNC,MAAO,EACPC,UAAU,EACVC,gBAAgB,EAChBC,cAAc,EACdC,sBAAuB,EACvBC,oBAAqB,IACrBC,OAAO,GCjBF,SAASC,EAAOC,EAAWC,EAAU,oBAC1C,IAAKD,EAAW,CACd,GAAqB,oBAAVE,MAAuB,MAAM,IAAIA,MAAMD,GAElD,MAAMA,CACP,CACH,CA4BO,SAASE,EAASC,GACvB,MAAMC,EA3BD,WASL,GAJI,gBAAiBC,QAAW,IAC9BA,OAAOC,YAAc,IAGnB,QAASD,OAAOC,aAAgB,EAAO,CACzC,IAAIC,EAAYC,KAAKC,MAEjBH,YAAYI,QAAUJ,YAAYI,OAAOC,kBAC3CJ,EAAYD,YAAYI,OAAOC,iBAGjCN,OAAOC,YAAYG,IAAM,IAAMD,KAAKC,MAAQF,CAC7C,CAED,OAAOF,OAAOC,YAAYG,KAC5B,CAOaA,GAAMG,SAAS,IAE1B,OAAOT,EAASA,EAASC,EAAKA,CAChC,CAEO,SAASS,EAAUC,GACxB,MAAO,SAASC,KAAKD,EACvB,CCxDO,SAASE,EAASC,EAASC,EAAWC,GAC3C,GAAIC,MAAMC,QAAQJ,GAGhB,YAFAA,EAAQK,SAASC,GAASP,EAASO,EAAML,KAK3C,MAAMM,EAAQJ,MAAMC,QAAQH,GAAaA,EAAYA,EAAUO,MAAM,QAErE,IAAIC,EAAIF,EAAMG,OAEd,KAAOD,KACAE,EAASX,EAASO,EAAME,KAC3BG,EAAUZ,EAASO,EAAME,GAAIP,EAGnC,CAQO,SAASW,EAAYb,EAASC,EAAWC,GAC9C,GAAIC,MAAMC,QAAQJ,GAGhB,YAFAA,EAAQK,SAASC,GAASO,EAAYP,EAAML,EAAWC,KAKzD,MAAMK,EAAQJ,MAAMC,QAAQH,GAAaA,EAAYA,EAAUO,MAAM,QAErE,IAAIC,EAAIF,EAAMG,OAEd,KAAOD,KACDE,EAASX,EAASO,EAAME,KAC1BK,EAAad,EAASO,EAAME,GAAIP,EAGtC,CAOO,SAASS,EAASX,EAASe,GAEhC,OAAOf,EAAQgB,UAAYhB,EAAQgB,UAAUC,SAASF,GAAKG,EAAWH,GAAGjB,KAAKE,EAAQmB,UACxF,CAiEO,SAASC,EAASC,EAAMC,GAC7B,OAAOD,EAAKE,QAAQ,wBAAwB,CAACC,EAAKC,KAChD,MAAMC,OAAqBC,IAAbL,EAAIG,GAAqB,GAAKH,EAAIG,GAEhD,OAKKG,OALaF,GAMjBG,WAAW,IAAK,SAChBA,WAAW,IAAK,QAChBA,WAAW,IAAK,QAChBA,WAAW,IAAK,UAChBA,WAAW,IAAK,SAVO,GAE5B,CAWO,SAASC,EAAcC,EAAMV,GAClC,IAAIW,EAEJ,GAAI7B,MAAMC,QAAQ2B,IAOhB,GANAC,EAAOC,SAASH,cAAcC,EAAK,IAE/BA,EAAK,GAAG5C,KAAI6C,EAAK7C,GAAK4C,EAAK,GAAG5C,IAE9B4C,EAAK,GAAG9B,YAAW+B,EAAKb,UAAYY,EAAK,GAAG9B,WAE5C8B,EAAK,GAAGG,KAAM,CAChB,MAAMA,KAAEA,GAASH,EAAK,GAEtB,GAAI5B,MAAMC,QAAQ8B,GAAO,CACvB,IAAIzB,GAAK,EAET,OAASA,EAAIyB,EAAKxB,QAChBsB,EAAKG,aAAaD,EAAKzB,GAAG2B,KAAMF,EAAKzB,GAAGiB,MAElD,MACQM,EAAKG,aAAaD,EAAKE,KAAMF,EAAKR,MAErC,OAEDM,EAAOC,SAASH,cAAcC,GAGhCC,EAAKK,UAAYhB,EAEjB,MAAMiB,EAAOL,SAASM,yBAEtB,KAAOP,EAAKQ,WAAW,IAAIF,EAAKG,OAAOT,EAAKQ,WAAW,IAIvD,OAFAR,EAAKS,OAAOH,GAELN,CACT,CAEA,SAASd,EAAWjB,GAClB,OAAO,IAAIyC,OAAO,YAAYzC,aAAsB,IACtD,CAEA,SAASW,EAAU+B,EAAIC,EAAO1C,GAExByC,EAAG3B,UACL2B,EAAG3B,UAAU6B,IAAID,GAEjBD,EAAGxB,UAAY,GAAGwB,EAAGxB,aAAayB,IAAQE,OAGxC5C,GAAWN,EAAUM,IACvBd,OAAO2D,YAAW,IAAMjC,EAAa6B,EAAIC,IAAQ1C,EAErD,CAEA,SAASY,EAAa6B,EAAIC,EAAO1C,GAC3ByC,EAAG3B,UACL2B,EAAG3B,UAAUgC,OAAOJ,GAEpBD,EAAGxB,UAAYwB,EAAGxB,UAAUI,QAAQL,EAAW0B,GAAQ,KAAKE,OAG1D5C,GAAWN,EAAUM,IACvBd,OAAO2D,YAAW,IAAMnC,EAAU+B,EAAIC,IAAQ1C,EAElD,CC1MA,MAAM+C,EAAUtF,EAAKuF,WAKd,MAAMC,EAKX,WAAAC,CAAYC,GACVC,KAAKD,QAAUA,EACfC,KAAKC,IAAMD,KAAKE,eACjB,CAED,aAAAA,GACE,IAAIC,EACAC,EACAC,EAkCJ,OAhCIL,KAAKD,QAAQjF,aAAeN,GAC9B4F,EAAiB,GAAGT,EAAQW,aAAaX,EAAQY,UAAUJ,YAC3DA,EAAY3B,EACV,CAAC,MAAO,CAAE3C,GAAIxB,EAAKmG,YAAa7D,UAAWyD,IAC3CP,EAAKY,OAEPJ,EAAW,CACTF,YACAO,QAASP,EAAUQ,cAAc,IAAIhB,EAAQY,UAAUG,WACvDD,MAAON,EAAUQ,cAAc,IAAIhB,EAAQY,UAAUE,SACrDG,MAAOT,EAAUQ,cAAc,IAAIhB,EAAQY,UAAUK,SACrDC,OAAQV,EAAUQ,cAAc,IAAIhB,EAAQY,UAAUM,aAGxDT,EAAiB,GAAGT,EAAQW,aAAaX,EAAQmB,MAAMX,YACvDA,EAAY3B,EACV,CAAC,MAAO,CAAE3C,GAAIxB,EAAKmG,YAAa7D,UAAWyD,IAC3CP,EAAKiB,OAEPT,EAAW,CACTF,YACAO,QAASP,EAAUQ,cAAc,IAAIhB,EAAQmB,MAAMJ,WACnDK,OAAQZ,EAAUQ,cAAc,IAAIhB,EAAQmB,MAAMC,UAClDN,MAAON,EAAUQ,cAAc,IAAIhB,EAAQmB,MAAML,SACjDG,MAAOT,EAAUQ,cAAc,IAAIhB,EAAQmB,MAAMF,SACjDC,OAAQV,EAAUQ,cAAc,IAAIhB,EAAQmB,MAAMD,YAKtDR,EAASI,MAAM7F,YAAcoF,KAAKD,QAAQnF,YAEnCyF,CACR,EAGHR,EAAKiB,MAAQ,mBACGnB,EAAQmB,MAAMJ,WAAWf,EAAQqB,8CACjB3G,EAAK4G,2BAA2BtB,EAAQmB,MAAMC,iDACjD1G,EAAK6G,wBAAwBvB,EAAQmB,MAAML,mEAC3DpG,EAAK8G,wBAAwBxB,EAAQmB,MAAMF,SAASjB,EAAQyB,wCAE1DzB,EAAQmB,MAAMD,kBAG7BhB,EAAKY,MAAQ,mBACGd,EAAQY,UAAUG,yCACLrG,EAAK6G,wBAAwBvB,EAAQY,UAAUE,yEACzDd,EAAQY,UAAUc,gDACLhH,EAAK8G,wBAAwBxB,EAAQY,UAAUK,SAASjB,EAAQyB,6CAEjFzB,EAAQY,UAAUM,kBCxE1B,MAAMS,EAIX,WAAAxB,GACEE,KAAKuB,SAAW,CACdC,IAAK,gCAELC,OAAQ,CACNC,EAAG,GACH1G,MAAO,GACPD,KAAM,MAGR4G,MAAO,CAAC,KAAM,KAAM,KAAM,MAE7B,CAED,aAAAC,CAAc7B,GAGZ,OAFAA,EAAQhF,KAAOgF,EAAQhF,KAAK8G,cAErB,CACLL,IAAKxB,KAAKuB,SAASC,IAEnBC,OAAQ,CACNC,EAAG3B,EAAQ+B,MACX9G,MAAO+E,EAAQ/E,OAASgF,KAAKuB,SAASE,OAAOzG,MAE7CD,KAAMiF,KAAKuB,SAASI,MAAMI,SAAShC,EAAQhF,MAAQgF,EAAQhF,KAAOiF,KAAKuB,SAASE,OAAO1G,MAG5F,CAED,cAAAiH,CAAeC,GACb,OAAgC,IAA5BA,EAAQC,SAAS9E,OAAqB,GAEnC6E,EAAQC,SAASC,KAAKtB,IAAY,CACvCuB,IAAKvB,EAAOwB,SAASC,YAAY,GACjCC,IAAK1B,EAAOwB,SAASC,YAAY,GAEjCE,QAAS,CACP1D,KAAM+B,EAAO4B,WAAW3D,KACxB4D,SAAU7B,EAAO4B,WAAWC,SAC5BC,KAAM9B,EAAO4B,WAAWE,KACxBC,MAAO/B,EAAO4B,WAAWG,MACzBC,QAAShC,EAAO4B,WAAWI,SAG7BC,SAAU,CACRC,UAAWlC,EAAO4B,WAAW3D,KAC7BkE,QAASnC,EAAO4B,eAGrB,ECrDI,MAAMQ,EAIX,WAAAnD,GACEE,KAAKuB,SAAW,CACdC,IAAK,6CAELC,OAAQ,CACNC,EAAG,GACHwB,OAAQ,OACRC,eAAgB,EAChBnI,MAAO,GACPoI,aAAc,GACd,kBAAmB,SAGxB,CAED,aAAAxB,CAAcyB,GACZ,MAAO,CACL7B,IAAKxB,KAAKuB,SAASC,IAEnBC,OAAQ,CACNC,EAAG2B,EAAIvB,MACPoB,OAAQlD,KAAKuB,SAASE,OAAOyB,OAC7BC,eAAgBnD,KAAKuB,SAASE,OAAO0B,eACrCnI,MAAOqI,EAAIrI,OAASgF,KAAKuB,SAASE,OAAOzG,MACzCoI,aAAcC,EAAID,cAAgBpD,KAAKuB,SAASE,OAAO2B,aACvD,kBAAmBC,EAAItI,MAAQiF,KAAKuB,SAASE,OAAO,oBAGzD,CAED,cAAAO,CAAeC,GACb,OAAuB,IAAnBA,EAAQ7E,OAAqB,GAE1B6E,EAAQE,KAAKtB,IAAY,CAC9BuB,IAAKvB,EAAOuB,IACZG,IAAK1B,EAAO0B,IACZe,KAAMzC,EAAO0C,YAEbf,QAAS,CACP1D,KAAM+B,EAAO2C,aACbC,KAAM5C,EAAO2B,QAAQiB,MAAQ,GAC7BC,YAAa7C,EAAO2B,QAAQmB,cAAgB,GAC5CjB,SAAU7B,EAAO2B,QAAQE,SACzBC,KAAM9B,EAAO2B,QAAQG,MAAQ9B,EAAO2B,QAAQoB,KAC5ChB,MAAO/B,EAAO2B,QAAQI,MACtBC,QAAShC,EAAO2B,QAAQK,SAG1BC,SAAU,CACRC,UAAWlC,EAAO2C,aAClBR,QAASnC,EAAO2B,YAGrB,ECzDI,MAAMqB,EAIX,WAAA/D,GACEE,KAAKuB,SAAW,CACdC,IAAK,uDAELC,OAAQ,CACNC,EAAG,GACHvD,IAAK,GACL+E,OAAQ,OACRC,eAAgB,EAChBnI,MAAO,GACPoI,aAAc,GACd,kBAAmB,SAGxB,CAED,aAAAxB,CAAc7B,GACZ,MAAO,CACLyB,IAAKxB,KAAKuB,SAASC,IAEnBC,OAAQ,CACNC,EAAG3B,EAAQ+B,MACX3D,IAAK4B,EAAQ5B,IACb+E,OAAQ,OACRC,eAAgB,EAChBnI,MAAO+E,EAAQ/E,OAASgF,KAAKuB,SAASE,OAAOzG,MAC7CoI,aAAcrD,EAAQqD,cAAgBpD,KAAKuB,SAASE,OAAO2B,aAE3D,kBAAmBrD,EAAQhF,MAAQiF,KAAKuB,SAASE,OAAO,oBAG7D,CAED,cAAAO,CAAeC,GACb,OAAuB,IAAnBA,EAAQ7E,OAAqB,GAE1B6E,EAAQE,KAAKtB,IAAY,CAC9BuB,IAAKvB,EAAOuB,IACZG,IAAK1B,EAAO0B,IAEZC,QAAS,CACP1D,KAAM+B,EAAO2B,QAAQsB,eAAiB,GACtCL,KAAM5C,EAAO2B,QAAQiB,MAAQ,GAC7Bf,SAAU7B,EAAO2B,QAAQE,SACzBC,KAAM9B,EAAO2B,QAAQG,MAAQ9B,EAAO2B,QAAQoB,KAC5ChB,MAAO/B,EAAO2B,QAAQI,MACtBC,QAAShC,EAAO2B,QAAQK,SAG1BC,SAAU,CACRC,UAAWlC,EAAO2C,aAClBR,QAASnC,EAAO2B,YAGrB,EC1DI,MAAMuB,EAIX,WAAAjE,GACEE,KAAKuB,SAAW,CACdC,IAAK,iDACLwC,aAAc,QAEdvC,OAAQ,CACNK,MAAO,GACP3D,IAAK,GACL8F,oBAAqB,EACrBC,WAAY,IAGjB,CAED,aAAAtC,CAAc7B,GACZ,MAAO,CACLyB,IAAKxB,KAAKuB,SAASC,IACnBwC,aAAchE,KAAKuB,SAASyC,aAE5BvC,OAAQ,CACNK,MAAO/B,EAAQ+B,MACf3D,IAAK4B,EAAQ5B,IAEb8F,oBACElE,EAAQkE,qBAAuBjE,KAAKuB,SAASE,OAAOwC,oBAEtDC,WAAYnE,EAAQmE,YAAclE,KAAKuB,SAASE,OAAOyC,YAG5D,CAED,cAAAlC,CAAeC,GACb,MAAMkC,UAAEA,GAAclC,EAAQmC,aAAa,GAE3C,OAAyB,IAArBD,EAAU/G,OAAqB,GAE5B+G,EAAUhC,KAAKtB,IAAY,CAChCuB,IAAKvB,EAAOwD,MAAM/B,YAAY,GAC9BC,IAAK1B,EAAOwD,MAAM/B,YAAY,GAE9BE,QAAS,CACP1D,KAAM+B,EAAO/B,MAGfgE,SAAU,CACRC,UAAWlC,EAAO2B,QAAQ8B,iBAC1BtB,QAASnC,EAAO2B,YAGrB,ECrDI,MAAM+B,EAIX,WAAAzE,GACEE,KAAKuB,SAAW,CACdC,IAAK,gDAELC,OAAQ,CACNC,EAAG,GACHvD,IAAK,GACLnD,MAAO,GACPwJ,YAAa,GACbC,OAAQ,EACRC,eAAgB,GAGrB,CAED,aAAA9C,CAAc7B,GACZ,MAAO,CACLyB,IAAKxB,KAAKuB,SAASC,IAEnBC,OAAQ,CACNC,EAAG3B,EAAQ+B,MACX3D,IAAK4B,EAAQ5B,IACbnD,MAAO+E,EAAQ/E,OAASgF,KAAKuB,SAASE,OAAOzG,MAC7CwJ,YAAazE,EAAQqD,cAAgBpD,KAAKuB,SAASE,OAAO2B,cAG/D,CAED,cAAApB,CAAeC,GACb,OAA+B,IAA3BA,EAAQA,QAAQ7E,OAAqB,GAElC6E,EAAQA,QAAQE,KAAKtB,IAAY,CACtCuB,IAAKvB,EAAOwB,SAASsC,IACrBpC,IAAK1B,EAAOwB,SAASE,IAErBC,QAAS,CACP1D,KAAM+B,EAAO+D,WAAWjB,cAAgB,GACxCF,KAAM5C,EAAO+D,WAAWnB,MAAQ,GAChCf,SAAU7B,EAAO+D,WAAWlC,SAC5BC,KAAM9B,EAAO+D,WAAWjC,MAAQ9B,EAAO+D,WAAWhB,KAClDhB,MAAO/B,EAAO+D,WAAWhC,MACzBC,QAAShC,EAAO+D,WAAW/B,SAG7BC,SAAU,CACRC,UAAWlC,EAAOkC,UAClBC,QAASnC,EAAO+D,eAGrB,ECxDI,SAASC,EAAKC,GACnB,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAC3B,MAAMzD,EAgCV,SAAsBA,EAAK0D,GACrBA,GAAwB,iBAATA,IACjB1D,IAAQ,MAAMhF,KAAKgF,GAAO,IAAM,KAAO2D,GAAcD,IAGvD,OAAO1D,CACT,CAtCgB4D,CAAaN,EAAItD,IAAKsD,EAAII,MAChCG,EAAS,CACbC,OAAQ,MACRC,KAAM,OACNC,YAAa,eAGXV,EAAIW,MAiCZ,SAAejE,EAAKrD,EAAKuH,GAEvB,MAAMC,KAAEA,GAAShH,SACXiH,EAASjH,SAASH,cAAc,UAEhCwF,EAAe,IAAI6B,KAAKC,MAAMD,KAAKE,SAAW9J,KAAKC,SAGzD0J,EAAO/G,aACL,MAIA,GAAG2C,GAAOA,EAAIwE,QAAQ,KAAO,EAAI,IAAM,KAAO7H,KAAO6F,KAMvDlI,OAAOkI,GAAiBkB,IACtBpJ,OAAOkI,QAAgB3F,EAGvBoB,YAAW,IAAMkG,EAAKM,YAAYL,IAAS,GAG3CF,EAASR,EAAK,EAIhBS,EAAKxG,OAAOyG,EACd,CA/DMH,CAAMjE,EAAKsD,EAAId,aAAcgB,GAE7BkB,MAAM1E,EAAK6D,GACRc,MAAMC,GAAMA,EAAEvB,SACdsB,KAAKnB,GACLqB,MAAMpB,EACV,GAEL,CAEA,SAASE,GAAcL,GACrB,OAAOwB,OAAOC,KAAKzB,GAChB0B,QAAO,CAACC,EAAKC,KACZD,EAAIE,KACgB,iBAAX7B,EAAI4B,GACPvB,GAAcL,EAAI4B,IAClB,GAAGE,mBAAmBF,MAAME,mBAAmB9B,EAAI4B,OAGlDD,IACN,IACFI,KAAK,IACV,CCRA,MAAMlH,GAAUtF,EAAKuF,WAKd,MAAMkH,GAKX,WAAAhH,CAAYiH,EAAM9G,GAChBD,KAAKgH,KAAOD,EAEZ/G,KAAKiH,UAAYtL,EAAS,mBAC1BqE,KAAKkH,MAAQ,IAAIC,UAAY,CAC3BrI,KAAMkB,KAAKiH,UACXG,OAAQ,IAAIC,EAAAA,UAGdrH,KAAKD,QAAUgH,EAAKhH,QAGpBC,KAAKD,QAAQpF,SACsB,iBAA1BqF,KAAKD,QAAQpF,SAChBqF,KAAKD,QAAQpF,SAASkH,cACtB7B,KAAKD,QAAQpF,SACnBqF,KAAKrF,SAAWqF,KAAKsH,cAErBtH,KAAKC,IAAMA,EACXD,KAAKuH,UAAY,GACjBvH,KAAKG,UAAYH,KAAKC,IAAIE,UAC1BH,KAAKwH,oBAAsB,CAAEC,UAAU,GACvCzH,KAAK0H,cACN,CAED,YAAAA,GACE,IAAI9K,EACA2K,EAEJ,MAAMI,EAAcC,IAClBA,EAAIC,kBAEJxK,EAAS2C,KAAKC,IAAIS,QAASf,GAAQmB,MAAMgH,UAAY9H,KAAK+H,WAAa/H,KAAKgI,QAAQ,EA2CtFhI,KAAKC,IAAIQ,MAAMwH,iBAAiB,YAzCjBL,IACb,MAAMxJ,EAAQwJ,EAAIM,OAAO9J,MAAMoB,QACnBoI,EAAIzJ,IACA,UAAZyJ,EAAIzJ,IACJyJ,EAAIO,MACU,KAAdP,EAAIO,QACJP,EAAIQ,SACY,KAAhBR,EAAIQ,WAINR,EAAI1M,iBACJ8E,KAAK8B,MAAM1D,GACZ,IA4BgD,GACnD4B,KAAKC,IAAIQ,MAAMwH,iBAAiB,SA3BVL,GAAQA,EAAIC,oBA2BqB,GACvD7H,KAAKC,IAAIQ,MAAMwH,iBAAiB,SApBXL,IACnB,MAAMxJ,EAAQwJ,EAAIM,OAAO9J,MAAMoB,OAEd,IAAjBpB,EAAMhB,OACFG,EAAYyC,KAAKC,IAAIW,MAAOjB,GAAQyB,QACpC3E,EAASuD,KAAKC,IAAIW,MAAOjB,GAAQyB,QAEjCpB,KAAKD,QAAQ5E,cAAgBiD,IAAUmJ,IACzCA,EAAYnJ,EACZxB,GAAWyL,aAAazL,GACxBA,EAAU6C,YAAW,KACfrB,EAAMhB,QAAU4C,KAAKD,QAAQ3E,uBAC/B4E,KAAK8B,MAAM1D,EACZ,GACA4B,KAAKD,QAAQ1E,qBACjB,IAKmD,GACtD2E,KAAKC,IAAIW,MAAMqH,iBAAiB,SA5BjBL,IACb5H,KAAKC,IAAIQ,MAAM6H,QACftI,KAAKC,IAAIQ,MAAMrC,MAAQ,GACvB4B,KAAKuH,UAAY,GACjB9K,EAASuD,KAAKC,IAAIW,MAAOjB,GAAQyB,QACjCpB,KAAKuI,cAAc,IAuB2B,GAE5CvI,KAAKD,QAAQjF,aAAeN,GAC9BwF,KAAKC,IAAIc,OAAOkH,iBAAiB,QAASN,GAAY,EAEzD,CAED,KAAA7F,CAAMJ,GAEC1B,KAAKrF,WACRqF,KAAKrF,SAAWqF,KAAKsH,eAGvB,MAAMkB,EAAaxI,KAAKrF,SAASiH,cAAc,CAC7CE,MAAOJ,EACPvD,IAAK6B,KAAKD,QAAQ5B,IAClBpD,KAAMiF,KAAKD,QAAQhF,KACnBqI,aAAcpD,KAAKD,QAAQqD,aAC3BpI,MAAOgF,KAAKD,QAAQ/E,QAGtB,GAAIgF,KAAKuH,YAAc7F,GAAK1B,KAAKC,IAAIY,OAAO4H,WAAY,OAExDzI,KAAKuH,UAAY7F,EACjB1B,KAAKuI,eACL9L,EAASuD,KAAKC,IAAIW,MAAOjB,GAAQ+I,MAEjC,MAAMC,EAAO,CACXnH,IAAKgH,EAAWhH,IAChB0D,KAAMsD,EAAW/G,QAGf+G,EAAWxE,eACb2E,EAAKlD,OAAQ,EACbkD,EAAK3E,aAAewE,EAAWxE,cAGjCa,EAAK8D,GACFxC,MAAMyC,IAEL5I,KAAKD,QAAQzE,OAASuN,QAAQC,KAAKF,GAEnCrL,EAAYyC,KAAKC,IAAIW,MAAOjB,GAAQ+I,MAGpC,MAAMK,EAAO/I,KAAKrF,SAASqH,eAAe4G,GAEtCG,IACF/I,KAAKgJ,WAAWD,GAChB/I,KAAKiJ,iBACN,IAEF5C,OAAO6C,IACN3L,EAAYyC,KAAKC,IAAIW,MAAOjB,GAAQ+I,MAEpC,MAAMS,EAAK3K,EAAc,KAAM,2CAE/BwB,KAAKC,IAAIY,OAAO1B,OAAOgK,EAAG,GAE/B,CAED,UAAAH,CAAWI,GACT,MAAMC,EAAKrJ,KAAKC,IAAIY,OAEpBuI,EAASrM,SAASiB,IAChB,IAAIsL,EAEJ,GAAQtJ,KAAKD,QAAQpF,WACdF,EACH6O,EAAc,gBAAgB3J,GAAQ8D,SAASzF,EAAIwE,QAAQ1D,mBAK3DwK,EAActJ,KAAKuJ,gBAAgBvL,EAAIwE,SAG3C,MACM2G,EAAK3K,EAAc,KADZ,eAAe8K,SAG5BH,EAAGlB,iBACD,SACCL,IACCA,EAAI1M,iBACJ8E,KAAKwJ,OAAOxL,EAAKsL,EAAatL,EAAIwE,QAASxE,EAAI8E,SAAS,IAE1D,GAGFuG,EAAGlK,OAAOgK,EAAG,GAEhB,CAED,MAAAK,CAAOC,EAAOH,EAAaI,EAAYC,GACrC,MAAMxH,EAAMnC,KAAKgH,KAAK4C,SAChBC,EAAS,CAACC,OAAOC,WAAWN,EAAMrH,KAAM0H,OAAOC,WAAWN,EAAMlH,MAChEyH,EAAa7H,EAAI8H,UAAUC,gBAC3BC,EAAQC,EAAAA,QAAKC,UAAUR,EAAQ,YAAaG,GAElD,IAAI1G,KAAEA,GAASmG,EAEXnG,IACFA,EAAO8G,EAAI,QAACE,gBACV,CAAChH,EAAK,GAAIA,EAAK,GAAIA,EAAK,GAAIA,EAAK,IACjC,YACA0G,IAIJ,MAAMxH,EAAU,CACdO,UAAWuG,EACXtG,QAAS0G,EACT5G,SAAU6G,GAKZ,IAF0B,IAA1B3J,KAAKD,QAAQ9E,UAAsB+E,KAAKuI,cAAa,IAEjB,IAAhCvI,KAAKD,QAAQ7E,eACf8E,KAAKgH,KAAKuD,cAAc,CACtBC,KAAMlQ,EACNkI,UACAiI,WAAYN,EACZ7G,OACAmG,cAEG,CACDnG,EACFnB,EAAI8H,UAAUS,IAAIpH,EAAM,CAAEqH,SAAU,MT1LrC,SAAexI,EAAKgI,EAAOQ,EAAW,IAAKC,EAAa,mBAC7DzI,EAAI8H,UAAUY,QAAQ,CAAEF,WAAUC,cAAc,CAAED,WAAUG,OAAQX,GACtE,CS0LQY,CAAM5I,EAAKgI,GAGb,MAAMa,EAAUhL,KAAKiL,cAAcd,EAAO3H,GAE1CxC,KAAKgH,KAAKuD,cAAc,CACtBC,KAAMlQ,EACNkI,UACAwI,UACAP,WAAYN,EACZ7G,OACAmG,SAEH,CACF,CAED,aAAAwB,CAAcd,GACZ,MAAMa,EAAU,IAAIE,EAAO,QAAC,IAAIC,EAAAA,QAAMhB,IAOtC,OALAnK,KAAKoL,WACLJ,EAAQK,SAASrL,KAAKD,QAAQlF,cAC9BmQ,EAAQM,MAAM3P,EAAS,iBACvBqE,KAAKuL,YAAYC,WAAWR,GAErBA,CACR,CAED,eAAAzB,CAAgB/G,GACd,MAAMzE,EAAO,GAsBb,OApBIyE,EAAQ1D,MACVf,EAAK4I,KAAK,CAAC,gBAAiBhH,GAAQ8D,KAAM,mBAAmBoD,KAAK,MAGhErE,EAAQiB,MAAQjB,EAAQiJ,UAAYjJ,EAAQmB,eAC9C5F,EAAK4I,KACH,CAAC,gBAAiBhH,GAAQ8D,KAAM,6CAA6CoD,KAAK,MAIlFrE,EAAQG,MAAQH,EAAQoB,MAAQpB,EAAQkJ,UAC1C3N,EAAK4I,KACH,CAAC,gBAAiBhH,GAAQgD,KAAM,+CAA+CkE,KAAK,MAIpFrE,EAAQI,OAASJ,EAAQK,UAC3B9E,EAAK4I,KAAK,CAAC,gBAAiBhH,GAAQkD,QAAS,8BAA8BgE,KAAK,KAG3E/I,EAASC,EAAK8I,KAAK,QAASrE,EACpC,CAED,WAAA8E,GACE,OAAQtH,KAAKD,QAAQpF,UACnB,KAAKF,EACH,OAAO,IAAIwI,EACb,KAAKxI,EACH,OAAO,IAAIoJ,EACb,KAAKpJ,EACH,OAAO,IAAI6G,EACb,KAAK7G,EACH,OAAO,IAAIsJ,EACb,KAAKtJ,EACH,OAAO,IAAI8J,EAEb,QACE,OAAOvE,KAAKD,QAAQpF,SAEzB,CAED,MAAAqN,GACEzK,EAAYyC,KAAKC,IAAIQ,MAAOd,GAAQ+I,MACpCjM,EAASuD,KAAKC,IAAIS,QAASf,GAAQmB,MAAMgH,UACzChM,OAAO2D,YAAW,IAAMO,KAAKC,IAAIQ,MAAM6H,SAAS,KAChDtI,KAAKiJ,gBACN,CAED,QAAAlB,GACE/H,KAAKC,IAAIQ,MAAMrC,MAAQ,GACvB4B,KAAKC,IAAIQ,MAAMkL,OACflP,EAASuD,KAAKC,IAAIW,MAAOjB,GAAQyB,QACjC7D,EAAYyC,KAAKC,IAAIS,QAASf,GAAQmB,MAAMgH,UAC5C9H,KAAKuI,cACN,CAED,cAAAU,GAEE,GAAIjJ,KAAKwH,oBAAoBC,SAAU,OAEvC,MAAMmE,EAAO5L,KACP6L,EAAa7L,KAAKgH,KAAK4C,SAASkC,mBAEtC9L,KAAKwH,oBAAoBC,UAAW,EAGpCoE,EAAW5D,iBACT,QACA,CACE,WAAA8D,CAAYnE,GACVgE,EAAKrD,cAAa,GAClBsD,EAAWG,oBAAoBpE,EAAI4C,KAAMxK,MAAM,GAC/C4L,EAAKpE,oBAAoBC,UAAW,CACrC,IAEH,EAEH,CAED,YAAAc,CAAaR,GACXA,GAAY/H,KAAKD,QAAQjF,aAAeN,EACpCwF,KAAK+H,WRpPN,SAA2BtJ,GAChC,KAAOA,EAAKgK,YAAYhK,EAAKgK,WAAW/I,QAC1C,CQmPQuM,CAAkBjM,KAAKC,IAAIY,OAChC,CAED,SAAA0K,GACE,OAAOvL,KAAKkH,MAAMqE,WACnB,CAED,QAAAH,GACE,IAAIc,GAAQ,EAEZ,MAAM/J,EAAMnC,KAAKgH,KAAK4C,SAEtBzH,EAAIgK,YAAYpP,SAASmK,IACnBA,IAAUlH,KAAKkH,QAAOgF,GAAQ,EAAI,IAGnCA,GAAO/J,EAAIiJ,SAASpL,KAAKkH,MAC/B,ECpWY,MAAMF,WAAaoF,EAAAA,QAMhC,WAAAtM,CAAY0K,EAAOjQ,EAAwBwF,EAAU,CAAA,GAanD,IAAII,EAEAkM,EAdJ9Q,EAAuB,iBAATiP,EAAmB,mCACjCjP,EACEiP,IAASjQ,GAA0BiQ,IAASjQ,EAC5C,4BAA4BA,iBACtBA,OAERgB,EAA0B,iBAAZwE,EAAsB,sCAEpCrF,EAAgBG,aAAe,CAC7B,IAAIyR,UAAM,CAAEC,MAAO,IAAIC,UAAK,CAAEC,MAAO,GAAKC,IXZrB,yEWmBvB,MAAMC,EAAQ,IAAI9M,EAAKE,GAQvB,GANIyK,IAASjQ,IACX4F,EAAYwM,EAAM1M,IAAIE,WAGxByM,MAAM,CAAElQ,QAASyD,MAEXH,gBAAgBgH,IAAO,OAAO,IAAIA,GAExChH,KAAKD,QV1CF,SAAsB8M,EAAMC,GACjC,MAAMC,EAAO,CAAA,EAcb,OAZAzG,OAAOC,KAAKsG,GAAM9P,SAASoB,IACrBmI,OAAO0G,UAAUC,eAAeC,KAAKL,EAAM1O,KAC7C4O,EAAK5O,GAAO0O,EAAK1O,GAClB,IAGHmI,OAAOC,KAAKuG,GAAM/P,SAASoB,IACrBmI,OAAO0G,UAAUC,eAAeC,KAAKJ,EAAM3O,KAC7C4O,EAAK5O,GAAO2O,EAAK3O,GAClB,IAGI4O,CACT,CU0BmBI,CAAazS,EAAiBqF,GAC7CC,KAAKG,UAAYA,EAEbqK,IAASjQ,IACX8R,EAAa,IAAIvF,GAAU9G,KAAM2M,EAAM1M,KACvCD,KAAKkH,MAAQmF,EAAWnF,MAE3B,CAKD,QAAAkG,GACE,OAAOpN,KAAKkH,KACb,CAKD,SAAAqE,GACE,OAAOvL,KAAKoN,WAAW7B,WACxB,CAMD,WAAA8B,CAAY1S,GACVqF,KAAKD,QAAQpF,SAAWA,CACzB,CAMD,cAAA2S,CAAenP,GACb6B,KAAKD,QAAQ5B,IAAMA,CACpB"}